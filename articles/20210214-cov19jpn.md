---
title: "æ—¥æœ¬ç‰ˆ Google COVID-19 Forecast ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ Go ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½œã£ã¦ã¿ãŸ" # è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«
emoji: "ğŸ’»" # ã‚¢ã‚¤ã‚­ãƒ£ãƒƒãƒã¨ã—ã¦ä½¿ã‚ã‚Œã‚‹çµµæ–‡å­—ï¼ˆ1æ–‡å­—ã ã‘ï¼‰
type: "tech" # "tech" : æŠ€è¡“è¨˜äº‹ / "idea" : ã‚¢ã‚¤ãƒ‡ã‚¢è¨˜äº‹
topics: ["go", "programming"] # ã‚¿ã‚°ã€‚["markdown", "rust", "aws"] ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹
published: true # å…¬é–‹è¨­å®šï¼ˆtrue ã§å…¬é–‹ï¼‰
---

é€±æœ«ã®ä½™æš‡ã‚’åˆ©ç”¨ã—ã¦æ—¥æœ¬ç‰ˆ Google COVID-19 Forecast ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ»ãƒ„ãƒ¼ãƒ«ã‚’ä½œã£ã¦ã¿ãŸã®ã ãŒ

https://github.com/spiegel-im-spiegel/cov19jpn


ã“ã‚Œè‡ªä½“ã¯ [Go] ã§æ›¸ã„ã¦ã„ã‚‹ã®ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦ã‚‚åˆ©ç”¨ã§ãã‚‹ã€‚ãƒªãƒã‚¸ãƒˆãƒªã® sample ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã„ãã¤ã‹ã‚³ãƒ¼ãƒ‰ä¾‹ã‚’ç½®ã„ã¦ã„ã‚‹ã®ã§å‚è€ƒã«ã—ã¦æ¬²ã—ã„ã€‚

ãŸã¨ãˆã°

```go
// +build run

package main

import (
    "bytes"
    "context"
    "fmt"
    "io"
    "net/http"
    "os"

    "github.com/spiegel-im-spiegel/cov19jpn/entity"
    "github.com/spiegel-im-spiegel/cov19jpn/fetch"
    "github.com/spiegel-im-spiegel/cov19jpn/filter"
    "github.com/spiegel-im-spiegel/cov19jpn/values/prefcodejpn"
)

func main() {
    r, err := fetch.Web(context.Background(), &http.Client{})
    if err != nil {
        fmt.Fprintln(os.Stderr, err)
        return
    }
    defer r.Close()
    es, err := fetch.Import(
        r,
        filter.New(
            prefcodejpn.TOTTORI,
            prefcodejpn.SHIMANE,
            prefcodejpn.OKAYAMA,
            prefcodejpn.HIROSHIMA,
            prefcodejpn.YAMAGUCHI,
        ),
    )
    if err != nil {
        fmt.Fprintln(os.Stderr, err)
        return
    }
    list := entity.NewList(es)
    list.Sort()
    _, _ = io.Copy(os.Stdout, bytes.NewReader(list.EncodeCSV()))
}
```

ãªã©ã¨ã™ã‚Œã°ä¸­å›½5çœŒã®ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã§ãã‚‹ã€‚

æ—¢ã«ãƒ­ãƒ¼ã‚«ãƒ«ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ CSV ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã†ã®ã§ã‚ã‚Œã°

```go
r, err := fetch.Web(context.Background(), &http.Client{})
```

ã®ä»£ã‚ã‚Šã«

```go
r, err := fetch.File("./forecast_JAPAN_PREFECTURE_28.csv")
```

ã¨ã—ã¦ã‚‚OKã€‚

fetch.Import() é–¢æ•°ã®çµæœã¯

```go
package entity

import (
    "encoding/json"

    "github.com/spiegel-im-spiegel/cov19jpn/values/date"
    "github.com/spiegel-im-spiegel/cov19jpn/values/prefcodejpn"
)

type Entity struct {
    JapanPrefectureCode             prefcodejpn.Code `json:"japan_prefecture_code"`
    PrefectureName                  string           `json:"prefecture_name"`
    TargetPredictionDate            date.Date        `json:"target_prediction_date"`
    CumulativeConfirmed             *json.Number     `json:"cumulative_confirmed,omitempty"`
    CumulativeConfirmedQ0025        *json.Number     `json:"cumulative_confirmed_q0025,omitempty"`
    CumulativeConfirmedQ0975        *json.Number     `json:"cumulative_confirmed_q0975,omitempty"`
    CumulativeDeaths                *json.Number     `json:"cumulative_deaths,omitempty"`
    CumulativeDeathsQ0025           *json.Number     `json:"cumulative_deaths_q0025,omitempty"`
    CumulativeDeathsQ0975           *json.Number     `json:"cumulative_deaths_q0975,omitempty"`
    HospitalizedPatients            *json.Number     `json:"hospitalized_patients,omitempty"`
    HospitalizedPatientsQ0025       *json.Number     `json:"hospitalized_patients_q0025,omitempty"`
    HospitalizedPatientsQ0975       *json.Number     `json:"hospitalized_patients_q0975,omitempty"`
    Recovered                       *json.Number     `json:"recovered,omitempty"`
    RecoveredQ0025                  *json.Number     `json:"recovered_q0025,omitempty"`
    RecoveredQ0975                  *json.Number     `json:"recovered_q0975,omitempty"`
    CumulativeConfirmedGroundTruth  *json.Number     `json:"cumulative_confirmed_ground_truth,omitempty"`
    CumulativeDeathsGroundTruth     *json.Number     `json:"cumulative_deaths_ground_truth,omitempty"`
    HospitalizedPatientsGroundTruth *json.Number     `json:"hospitalized_patients_ground_truth,omitempty"`
    RecoveredGroundTruth            *json.Number     `json:"recovered_ground_truth,omitempty"`
    ForecastDate                    date.Date        `json:"forecast_date"`
    NewDeaths                       *json.Number     `json:"new_deaths,omitempty"`
    NewConfirmed                    *json.Number     `json:"new_confirmed,omitempty"`
    NewDeathsGroundTruth            *json.Number     `json:"new_deaths_ground_truth,omitempty"`
    NewConfirmedGroundTruth         *json.Number     `json:"new_confirmed_ground_truth,omitempty"`
    PrefectureNameKanji             string           `json:"prefecture_name_kanji,omitempty"`
}
```

ã§å®šç¾©ã•ã‚Œã‚‹æ§‹é€ ä½“ã®é…åˆ—ã¨ã—ã¦è¿”ã•ã‚Œã‚‹ã®ã§ï¼Œãã®ã¾ã¾ JSON å½¢å¼ã« encode ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã‚ã‚‹ã€‚ã¾ãŸ entity.NewList() é–¢æ•°ã§ entity.EntityList å‹ã«ãƒ©ãƒƒãƒ”ãƒ³ã‚°ã™ã‚Œã°ã‚½ãƒ¼ãƒˆã‚„ãƒ‡ãƒ¼ã‚¿ã®çµã‚Šè¾¼ã¿ã‚„ CSV ã¸ã® encode ç­‰ãŒæ¥½ã«ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚

æ£’ã‚°ãƒ©ãƒ•ã«ã¤ã„ã¦ã¯

```go
// +build run

package main

import (
    "context"
    "fmt"
    "net/http"
    "os"

    "github.com/spiegel-im-spiegel/cov19jpn/chart"
    "github.com/spiegel-im-spiegel/cov19jpn/entity"
    "github.com/spiegel-im-spiegel/cov19jpn/fetch"
    "github.com/spiegel-im-spiegel/cov19jpn/filter"
    "github.com/spiegel-im-spiegel/cov19jpn/values/prefcodejpn"
)

func main() {
    r, err := fetch.Web(context.Background(), &http.Client{})
    if err != nil {
        fmt.Fprintln(os.Stderr, err)
        return
    }
    defer r.Close()
    prefcode := prefcodejpn.TOKYO
    es, err := fetch.Import(
        r,
        filter.New(prefcode),
    )
    if err != nil {
        fmt.Fprintln(os.Stderr, err)
        return
    }
    list := entity.NewList(es)
    hlist := chart.New(list.StartDayMeasure(), list.EndDayMeasure().AddDay(7), 7, list)
    if err := chart.MakeHistChart(hlist, prefcode.Title(), "./output.png"); err != nil {
        fmt.Fprintln(os.Stderr, err)
    }
}
```

ã¨ã™ã‚Œã°ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ç‰ˆã¨åŒã˜

![output.png](https://text.baldanders.info/release/2021/02/cov19jpn/tokyo-cov19-chart.png)

ã¦ãªæ„Ÿã˜ã®å‡ºåŠ›ã‚’å¾—ã‚‰ã‚Œã‚‹ã€‚ã¾ãï¼Œã‚°ãƒ©ãƒ•ã«ã¤ã„ã¦ã¯å¥½ã¿ãªã©ã‚‚ã‚ã‚‹ã®ã§ï¼Œã‚ã¾ã‚Šå‚è€ƒã«ãªã‚‰ãªã„ã ã‚ã†ã€‚ç§ã¯ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»ã‚»ãƒ³ã‚¹ãŒå£Šæ»…ã—ã¦ã‚‹ã®ã§ï¼ˆç¬‘ï¼‰

ã‚ˆã‚ã—ã‹ã£ãŸã‚‰ã©ã†ãã€‚

## å‚è€ƒãƒªãƒ³ã‚¯

https://zenn.dev/spiegel/scraps/e992be8b03eeb7
https://text.baldanders.info/release/2021/02/cov19jpn/

[Go]: https://golang.org/ "The Go Programming Language"
