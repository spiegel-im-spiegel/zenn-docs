---
title: "Go ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.17 æ”¹è¨‚ç‰ˆã€‘"
emoji: "ğŸ’»" # ã‚¢ã‚¤ã‚­ãƒ£ãƒƒãƒã¨ã—ã¦ä½¿ã‚ã‚Œã‚‹çµµæ–‡å­—ï¼ˆ1æ–‡å­—ã ã‘ï¼‰
type: "tech" # "tech" : æŠ€è¡“è¨˜äº‹ / "idea" : ã‚¢ã‚¤ãƒ‡ã‚¢è¨˜äº‹
topics: ["go", "programming"] # ã‚¿ã‚°ã€‚["markdown", "rust", "aws"] ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹
published: true # å…¬é–‹è¨­å®šï¼ˆtrue ã§å…¬é–‹ï¼‰
---

[Go] ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã¤ã„ã¦ã¯[è‡ªãƒ–ãƒ­ã‚°](https://text.baldanders.info/golang/ "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª Go | text.Baldanders.info")ã§ã‚‚ã‚ˆãè©±é¡Œã«ã™ã‚‹ã®ã ãŒï¼Œå·®åˆ†æƒ…å ±ãŒå¤šãå†…å®¹ãŒåˆ†æ•£ã—ã¦ã„ã‚‹ãŸã‚ï¼Œã“ã“ã® Zenn ã§ã¾ã¨ã‚ã¦ãŠãã€‚ãªãŠï¼Œã“ã®è¨˜äº‹ã§ã¯ vendoring æ©Ÿèƒ½ã«ã¤ã„ã¦ã¯è¨€åŠã—ãªã„ã®ã§ã‚ã—ã‹ã‚‰ãš[^vdr1]ã€‚

[^vdr1]: Vendoring æ©Ÿèƒ½ã¯ [Go] 1.5 ã§è¿½åŠ ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†æ©Ÿèƒ½ã§ã‚ã‚‹ã€‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç›´ä¸‹ã«ä½œæˆã—ãŸ `vendor` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã‚’å¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚³ãƒ¼ãƒ‰ãƒ»ãƒ„ãƒªãƒ¼ã¨ã¿ãªã™ã€‚ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¯¾å¿œãƒ¢ãƒ¼ãƒ‰ãŒç™»å ´ã™ã‚‹ã¾ã§ã¯é‡å®ã•ã‚Œã¦ã„ãŸãŒï¼Œã©ã†ã—ã¦ã‚‚ã‚³ãƒ¼ãƒ‰ç®¡ç†ãŒå¤šé‡åŒ–ã—ã¦ã—ã¾ã†ãŸã‚ï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¯¾å¿œãƒ¢ãƒ¼ãƒ‰ã«æ¯”ã¹ã¦ï¼‰æ‰±ã„ãŒç…©é›‘ã«ãªã£ã¦ã—ã¾ã†ã®ãŒæ¬ ç‚¹ã§ã‚ã‚‹ã€‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¬é–‹ã—ãªã„å†…éƒ¨é–‹ç™ºã§ã‚ã‚Œã°ä½¿ã„é“ã¯ã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚ Vendoring ã«ã¤ã„ã¦ã¯æ‹™æ–‡ã€Œ[GOPATH æ±šæŸ“](https://text.baldanders.info/golang/gopath-pollution/)ã€ã§ç°¡å˜ã«è§£èª¬ã—ã¦ã„ã‚‹ã€‚

## ç”¨èªã®æ•´ç†

ã¾ãšæœ€åˆã«ç”¨èªã®å®šç¾©ã‚’ã—ã¦ãŠãã€‚

### GOPATH ãƒ¢ãƒ¼ãƒ‰ã¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¯¾å¿œãƒ¢ãƒ¼ãƒ‰

ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.11 ä»¥é™ã‹ã‚‰ [Go] ãƒ„ãƒ¼ãƒ«ãƒ¼ãƒã‚§ãƒ¼ãƒ³ã¯ä»¥ä¸‹ã®2ã¤ã®ãƒ¢ãƒ¼ãƒ‰ã®ã©ã¡ã‚‰ã‹ã§å‹•ä½œã™ã‚‹ã€‚

- **GOPATH ãƒ¢ãƒ¼ãƒ‰ (GOPATH mode)** : ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.10 ã¾ã§ã®ãƒ¢ãƒ¼ãƒ‰ã€‚æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’é™¤ãå…¨ã¦ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚³ãƒ¼ãƒ‰ç®¡ç†ã¨ãƒ“ãƒ«ãƒ‰ã‚’ç’°å¢ƒå¤‰æ•° GOPATH ã§æŒ‡å®šã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸‹ã§è¡Œã†ã€‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç®¡ç†ã¯ãƒªãƒã‚¸ãƒˆãƒªã®æœ€æ–°ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã®ã¿ãŒå¯¾è±¡ã¨ãªã‚‹
- **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¯¾å¿œãƒ¢ãƒ¼ãƒ‰ (module-aware mode)** : æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’é™¤ãå…¨ã¦ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦ç®¡ç†ã™ã‚‹ã€‚ã‚³ãƒ¼ãƒ‰ç®¡ç†ã¨ãƒ“ãƒ«ãƒ‰ã¯ä»»æ„ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å¯èƒ½ã§ï¼Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ãƒªãƒã‚¸ãƒˆãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¿ã‚°ã¾ãŸã¯ãƒªãƒ“ã‚¸ãƒ§ãƒ³æ¯ã«ç®¡ç†ã•ã‚Œã‚‹

### ã€Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€ã¨ã¯

[Go] ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«ãŠã‘ã‚‹å‡¦ç†å˜ä½ã€‚å…·ä½“çš„ã«ã¯ã²ã¨ã¤ã®ç‰©ç†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’ã²ã¨ã¤ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦å‡¦ç†ã™ã‚‹ã€‚ã¾ãŸï¼Œã‚¤ãƒ³ãƒãƒ¼ãƒˆå®£è¨€ï¼ˆimport declarationï¼‰ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æŒ‡å®šã™ã‚‹éš›ã«ã¯

```go
import "path/to/package"
```

ãªã©ã¨ï¼Œãƒ‘ã‚¹ã§æŒ‡å®šã™ã‚‹ã€‚ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¯æŒ‡å®šã•ã‚ŒãŸãƒ‘ã‚¹ã‚’è¦‹ã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æ¢ã™ã€‚

æœ€å„ªå…ˆã¯æ¨™æº–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ GOPATH ãƒ¢ãƒ¼ãƒ‰ã§ã‚ã‚Œã°ç’°å¢ƒå¤‰æ•° GOPATH ã§æŒ‡å®šã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã‚’æ¢ã™ã€‚ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¯¾å¿œãƒ¢ãƒ¼ãƒ‰ã§ã¯[ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥](#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E5%85%88)ã‹ã‚‰æ¢ã™ã€‚

go get ã¾ãŸã¯ go mod tidy ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ã‚ã‚‰ã‹ã˜ã‚å¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãŠãã“ã¨ã§å‚ç…§å¯èƒ½ã¨ãªã‚‹ï¼ˆ[Go] 1.16 ã‹ã‚‰[ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è‡ªå‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¯ç¦æ­¢](#go-mod-tidy-ã«ã‚ˆã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æƒ…å ±ã®æ›´æ–°)ã«ãªã£ãŸï¼‰ã€‚

### ã€Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ã¨ã¯

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¯¾å¿œãƒ¢ãƒ¼ãƒ‰ã§ã¯ï¼Œæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’é™¤ããƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã€Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆmoduleï¼‰ã€ã¨ã—ã¦ç®¡ç†ã™ã‚‹ã€‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå˜ä¸€ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡ã™ã®ã«å¯¾ã—ï¼Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ go.mod ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã®ï¼ˆgo.mod ã‚’å«ã¾ãªã„ï¼‰å…¨ã¦ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®é…ä¸‹ã¨ãªã‚‹ã€‚

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒ [git] ç­‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãƒ„ãƒ¼ãƒ«ã§ç®¡ç†ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆã¾ãŸã¯ãƒªãƒ“ã‚¸ãƒ§ãƒ³ï¼‰ã”ã¨ã«ç•°ãªã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨è¦‹ãªã•ã‚Œã‚‹ã€‚ã¤ã¾ã‚Šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å®Ÿä½“ã¯ã€Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸(s)ï¼‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ã¨ã„ã†ã“ã¨ã«ãªã‚‹ã€‚

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãƒ„ãƒ¼ãƒ«ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã¨é€£å‹•ã—ã¦ã„ã‚‹é–¢ä¿‚ä¸Šï¼ŒåŸºæœ¬çš„ã«ã¯ã€Œ1ãƒªãƒã‚¸ãƒˆãƒªï¼1ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ã§ã‚ã‚‹ï¼ˆã²ã¨ã¤ã®ãƒªãƒã‚¸ãƒˆãƒªã«è¤‡æ•°ã® go.mod ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã™ã‚‹ã“ã¨ã§è¤‡æ•°ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æ§‹æˆã™ã‚‹ã“ã¨ã¯å¯èƒ½ã ãŒï¼Œç®¡ç†ãŒã‚ã¡ã‚ƒã‚ã¡ã‚ƒç…©é›‘ã«ãªã‚‹ï¼‰ã€‚

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã¯æ¬¡ç¯€ã§ç¤ºã™ã‚ˆã†ã« go.mod ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã•ã‚Œã‚‹ãŒï¼Œå¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¸ã®ç‰©ç†ãƒ‘ã‚¹ã¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åãŒåŒã˜ã§ã‚ã‚Œã°ï¼Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¯¾å¿œãƒ¢ãƒ¼ãƒ‰ã¸ã®ç§»è¡Œã«ã‚ãŸã£ã¦ã‚½ãƒ¼ã‚¹ãƒ»ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãæ›ãˆã‚‹å¿…è¦ã¯ãªã„ã€‚

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¸ã®ç‰©ç†ãƒ‘ã‚¹ã¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å

ãŸã¨ãˆã°ï¼Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¯¾å¿œãƒ¢ãƒ¼ãƒ‰ã«ãŠã„ã¦å¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ github.com/spiegel-im-spiegel/pa-api/entity ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã«ã¯ï¼Œã‚½ãƒ¼ã‚¹ãƒ»ã‚³ãƒ¼ãƒ‰ã«ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®£è¨€ã‚’è¨˜è¿°ã™ã‚‹ã€‚

```go
import "github.com/spiegel-im-spiegel/pa-api/entity"
```

GOPATH ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®£è¨€ã§æŒ‡å®šã•ã‚ŒãŸãƒ‘ã‚¹ãŒãã®ã¾ã¾ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¸ã®ç‰©ç†ãƒ‘ã‚¹ã‚’æŒ‡ã—ã¦ã„ã‚‹ãŒï¼Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¯¾å¿œãƒ¢ãƒ¼ãƒ‰ã§ã¯ã¡ã‚‡ã£ã¨è¤‡é›‘ãªå‡¦ç†ã‚’è¡Œã£ã¦ã„ã‚‹ã€‚å…·ä½“çš„ã«ã¯

1. å®£è¨€ã•ã‚ŒãŸãƒ‘ã‚¹ã‚’è§£é‡ˆã—ã¦ [https://github.com/spiegel-im-spiegel/pa-api][spiegel-im-spiegel/pa-api] ã«ã‚ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®æŒ‡å®šãƒªãƒ“ã‚¸ãƒ§ãƒ³ã‚’ãƒ•ã‚§ãƒƒãƒã™ã‚‹ï¼ˆãƒªãƒ“ã‚¸ãƒ§ãƒ³ã¯è‡ªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® go.mod ãƒ•ã‚¡ã‚¤ãƒ«ã§æŒ‡å®šã•ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‹ã‚‰é¡æ¨ã™ã‚‹ï¼‰
2. ãƒ•ã‚§ãƒƒãƒã—ãŸãƒªãƒã‚¸ãƒˆãƒªã«ã‚ã‚‹ go.mod ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å `github.com/spiegel-im-spiegel/pa-api` ã‚’å–å¾—ã™ã‚‹ï¼ˆgo.mod ãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„å ´åˆã¯ç‰©ç†ãƒ‘ã‚¹ãŒãã®ã¾ã¾ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã¨ãªã‚‹ï¼‰
3. å®£è¨€ã•ã‚ŒãŸãƒ‘ã‚¹ã¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã‹ã‚‰ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª entity ã‚’è©²å½“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨è§£é‡ˆã—ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹

ã¨ã„ã£ãŸæ„Ÿã˜ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è§£é‡ˆã¨ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’è¡Œã†ã€‚ã—ãŸãŒã£ã¦ï¼Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¸ã®ç‰©ç†ãƒ‘ã‚¹ã¯ãªã‚‹ã¹ãåˆã‚ã›ãŸæ–¹ãŒï¼ˆå¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã™ã‚‹å´ã‹ã‚‰è¦‹ã¦ã‚‚ï¼‰é¢å€’ãŒå°‘ãªã„ã€‚ãŸã ã—ï¼Œå¾Œè¿°ã™ã‚‹[ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†](#semantic-versioning-%E3%81%AB%E3%82%88%E3%82%8B%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86)ã®éƒ½åˆä¸Šï¼Œã©ã†ã—ã¦ã‚‚ä¸¡è€…ãŒä¹–é›¢ã—ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚‹ã€‚

[spiegel-im-spiegel/pa-api]: https://github.com/spiegel-im-spiegel/pa-api "spiegel-im-spiegel/pa-api: APIs for Amazon Product Advertising API v5 by Golang"

## ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–¢é€£ã®ç’°å¢ƒå¤‰æ•°

è©³ã—ãã¯ä»¥ä¸‹ãŒå‚è€ƒã«ãªã‚‹ã€‚

https://zenn.dev/tennashi/articles/3b87a8d924bc9c43573e

ã“ã®è¨˜äº‹ã§ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†ã«é–¢é€£ã™ã‚‹ã‚‚ã®ã®ã¿æŒ™ã’ã¦ã„ãã€‚

### ç’°å¢ƒå¤‰æ•° GO111MODULE ã«ã‚ˆã‚‹ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆ

ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.11 ä»¥é™ã§ã¯ 2 ã¤ã®ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆã®ãŸã‚ã«ç’°å¢ƒå¤‰æ•° GO111MODULE ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã€‚

```
$ go env | grep GO111MODULE
GO111MODULE=""
```

GO111MODULE ã®å–ã‚Šã†ã‚‹å€¤ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚

| å€¤     | å†…å®¹ |
| ------ | ---- |
| `on`   | å¸¸ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¯¾å¿œãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œã™ã‚‹ |
| `off`  | å¸¸ã« GOPATH ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œã™ã‚‹ |
| `auto` | $GOPATH/src ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã•ã‚Œ go.mod ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã¾ãªã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ GOPATH ãƒ¢ãƒ¼ãƒ‰ã§ï¼Œãã‚Œä»¥å¤–ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¯¾å¿œãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œã™ã‚‹ |

ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.16 ã‹ã‚‰ GO111MODULE æœªæŒ‡å®šæ™‚ã®æ—¢å®šå€¤ãŒ `on` ã«ãªã£ãŸï¼ˆ1.15 ã¾ã§ã¯ `auto`ï¼‰ã€‚ GOPATH ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ã„ãŸã„ã®ã§ã‚ã‚Œã° GO111MODULE ã®å€¤ã‚’ `auto` ã¾ãŸã¯ `off` ã«è¨­å®šã™ã‚‹[^env1]ã€‚

[^env1]: [Go] ã®ç’°å¢ƒå¤‰æ•°ã®å–ã‚Šæ‰±ã„ã«ã¤ã„ã¦ã¯ï¼Œæ‹™æ–‡ã€Œ[Go è¨€èªã®ç’°å¢ƒå¤‰æ•°ç®¡ç†](https://text.baldanders.info/golang/go-env/)ã€ã‚’ã”è¦§ã‚ã‚Œã€‚

```
$ go env -w GO111MODULE=auto
```

ãŸã ã— [Go] ã§ã¯ç’°å¢ƒå¤‰æ•° GOPATH ã¸ã®ä¾å­˜ã‚’å¾ã€…ã«è–„ã‚ã¤ã¤ã‚ã‚Šï¼Œæœ€çµ‚çš„ã«ã¯ $GOPATH ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ä½¿ã‚ã‚Œãªããªã‚‹ã¨æ€ã‚ã‚Œã‚‹ã€‚

### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆ

[Go] ã§ã¯ go install ã‚³ãƒãƒ³ãƒ‰ã§ãƒ“ãƒ«ãƒ‰ã—ãŸå®Ÿè¡Œãƒã‚¤ãƒŠãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆã‚’ $GOPATH/bin ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã—ã¦ã„ã‚‹ãŒï¼Œã“ã‚Œã‚’ç’°å¢ƒå¤‰æ•° GOBIN ã§å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

```
$ go env -w GOBIN=/home/username/bin
```

### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥å…ˆ

æœ€è¿‘ã® [Go] ã§ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«çµæœã®ä¸­é–“ãƒã‚¤ãƒŠãƒªã‚’ç’°å¢ƒå¤‰æ•° GOCACHE ã§æŒ‡å®šã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ï¼Œå¯èƒ½ãªé™ã‚Šå†åˆ©ç”¨ã—ã‚ˆã†ã¨ã™ã‚‹ã€‚

```
$ go env | grep GOCACHE
GOCACHE="/home/usernamee/.cache/go-build"
```

ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã¤ã„ã¦ã¯ $GOPATH/pkg/mod ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã•ã‚Œã¦ã„ã‚‹ãŒ [Go] 1.15 ã‚ˆã‚Šç’°å¢ƒå¤‰æ•° GOMODCACHE ã§å¤‰æ›´ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚

```
$ go env | grep GOMODCACHE
GOMODCACHE="/home/usernamee/go/pkg/mod"

$ go env -w GOBIN=/home/usernamee/.cache/go-mod
```

ãªãŠï¼Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢ã¯

```bash:ãƒ“ãƒ«ãƒ‰ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢
$ go clean -cache
```

ã¾ãŸã¯

```bash:ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢
$ go clean -modcache
```

ã§å¯èƒ½ã§ã‚ã‚‹ã€‚

## go.mod ã¨ go.sum

æ—¢ã«ä½•åº¦ã‚‚ç™»å ´ã—ã¦ã„ã‚‹ãŒï¼Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ç®¡ç†ã¯ go.mod ãŠã‚ˆã³ go.sum ãƒ•ã‚¡ã‚¤ãƒ«ã§è¡Œã†ã€‚

### go.mod ã®ä½œæˆ

æ–°ãŸã« go.mod ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã«ã¯ï¼Œä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã€‚

```
$ go mod init github.com/spiegel-im-spiegel/pa-api
go: creating new go.mod: module github.com/spiegel-im-spiegel/pa-api
```

ã“ã‚Œã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å github.com/spiegel-im-spiegel/pa-api ã¨ã—ã¦ã‚«ãƒ¬ãƒ³ãƒˆãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç›´ä¸‹ã« go.mod ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã‚‹ã€‚ä¸­èº«ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚

```markup:go.mod
module github.com/spiegel-im-spiegel/pa-api

go 1.17
```

`module` ã‚„ `go` ã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ï¼ˆdirectiveï¼‰ã¨å‘¼ã°ã‚Œã‚‹ã‚‚ã®ã ã€‚ãŸã¨ãˆã° `module` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã‚’å®šç¾©ã™ã‚‹ã€‚ä»–ã« go.mod ãƒ•ã‚¡ã‚¤ãƒ«ã§ä½¿ãˆã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚

| ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ– | è¨˜è¿°ä¾‹                                          | å†…å®¹                   |
| -------------- | ----------------------------------------------- | ---------------------- |
| `module`       | `module my/thing`                               | ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å       |
| `go`           | `1.17`                                          | æœ‰åŠ¹ãª Go ãƒãƒ¼ã‚¸ãƒ§ãƒ³   |
| `require`      | `require other/thing v1.0.2`                    | ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ»ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« |
| `exclude`      | `exclude old/thing v1.2.3`                      | é™¤å¤–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«         |
| `replace`      | `replace bad/thing v1.4.5 => good/thing v1.4.5` | ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ç½®æ›       |
| `retract`      | `v1.0.5`                                        | æ’¤å›ãƒãƒ¼ã‚¸ãƒ§ãƒ³         |

1.17 ã‹ã‚‰ `go` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–æœªæŒ‡å®šæ™‚ã®æ—¢å®šå€¤ãŒ 1.11 ã¨ã¿ãªã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚

`replace` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åãŒç‰©ç†ãƒ‘ã‚¹ã¨å¯¾å¿œã—ã¦ãªãã¦ä¸Šæ‰‹ãã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ããªã„ç­‰ã®çŠ¶æ³ã§ä½¿ãˆã‚‹ã€‚ãŸã¨ãˆã°ã“ã‚“ãªæ„Ÿã˜ã€‚

```markup:go.mod
module sample

require gopkg.in/russross/blackfriday.v2 v2.0.1

replace gopkg.in/russross/blackfriday.v2 v2.0.1 => github.com/russross/blackfriday/v2 v2.0.1
```

ã¾ãŸï¼ŒåŒä¸€ãƒªãƒã‚¸ãƒˆãƒªå†…ã«è¤‡æ•°ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚ã‚‹å ´åˆã« `replace` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’ä½¿ã£ã¦ç›¸å¯¾ãƒ‘ã‚¹æŒ‡å®šãŒã§ãã‚‹ã‚ˆã†ã ã€‚

```markup:go.mod
module golang.org/x/tools/gopls

replace golang.org/x/tools => ../
```

`retract` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.16 ã‹ã‚‰å°å…¥ã•ã‚ŒãŸã‚‚ã®ã§

```markup:go.mod
// Remote-triggered crash in package foo. See CVE-2021-01234.
retract v1.0.5
```

ãªã©ã¨ã‚³ãƒ¡ãƒ³ãƒˆã¨å…±ã«æŒ‡å®šã—ã¦ãŠãã¨

```
$ go list -m -u all
example.com/lib v1.0.0 (retracted)
$ go get .
go: warning: example.com/lib@v1.0.5: retracted by module author:
    Remote-triggered crash in package foo. See CVE-2021-01234.
go: to switch to the latest unretracted version, run:
    go get example.com/lib@latest
```

ã¦ãªæ„Ÿã˜ã«ã‚³ãƒ¡ãƒ³ãƒˆã®å†…å®¹ã§ãƒ¯ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’å‡ºã—ã¦ãã‚Œã‚‹ã‚‰ã—ã„ã€‚

`module` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã®ç›´å‰ã«

```markup:go.mod
// Deprecated: use example.com/mod/v2 instead.
module example.com/mod
```

ãªã©ã¨è¨˜è¿°ã™ã‚‹ã¨ go list -m -u ã¨ã‹ã§éæ¨å¥¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦è­¦å‘Šã—ã¦ãã‚Œã‚‹ã‚‰ã—ã„ã€‚ Deprecated ã‚³ãƒ¡ãƒ³ãƒˆã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã«å¯¾ã—ã¦ä»˜ä¸ã•ã‚Œã‚‹ã€‚ãŸã¨ãˆã° v1 ç³»ã‹ã‚‰ v2 ç³»ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹éš›ã« v1 ç³»ã‚’éæ¨å¥¨ã«ã—ãŸã„å ´åˆã«ã¯å½¹ã«ç«‹ã¤ã ã‚ã†ã€‚

### go.sum ã®ä¸­èº«

go.sum ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã® SHA-256 ãƒã‚§ãƒƒã‚¯ã‚µãƒ å€¤ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã€‚ãŸã¨ãˆã° go.mod ãƒ•ã‚¡ã‚¤ãƒ«ã§ `require` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ãŒ

```markup:go.mod
require github.com/spiegel-im-spiegel/errs v1.0.2
```

ã¨æŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼Œ go.sum ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã¯

```markup:go.sum
github.com/spiegel-im-spiegel/errs v1.0.2 h1:v4amEwRDqRWjKHOILQnJSovYhZ4ZttEnBBXNXEzS6Sc=
github.com/spiegel-im-spiegel/errs v1.0.2/go.mod h1:UoasJYYujMcdkbT9USv8dfZWoMyaY3btqQxoLJImw0A=
```

ã¨ã„ã£ãŸæ„Ÿã˜ã«ãªã‚‹ã€‚

go.sum ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã¯ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å®Œå…¨æ€§ï¼ˆintegrityï¼‰ã‚’æ‹…ä¿ã™ã‚‹ã‚‚ã®ã ãŒ[^sum1]ï¼Œæ‰‹ä½œæ¥­ã§è¨˜è¿°ã§ãã‚‹ã‚ˆã†ãªã‚‚ã®ã§ã¯ãªã„ã®ã§ï¼Œæ¬¡ã«ç´¹ä»‹ã™ã‚‹ go mod tidy ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦æ›´æ–°ã™ã‚‹ã€‚

[^sum1]: [Go] ãŒ go.sum ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã£ã¦å®Œå…¨æ€§ã‚’ã©ã®ã‚ˆã†ã«ç®¡ç†ã—ã¦ã„ã‚‹ã‹ã«ã¤ã„ã¦ã¯æ‹™æ–‡ã€Œ[Go ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒŸãƒ©ãƒ¼ãƒªãƒ³ã‚°ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã€æ­£å¼ç‰ˆã€‘](https://text.baldanders.info/golang/mirror-index-and-checksum-database-for-go-module/)ã€ã‚’å‚è€ƒã«ã©ã†ãã€‚

### go mod tidy ã«ã‚ˆã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æƒ…å ±ã®æ›´æ–°

[Go] ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.15 ã¾ã§ã¯ go build ã‚„ go test ã¨ã„ã£ãŸã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œæ™‚ã« go.mod ãŠã‚ˆã³ go.sum ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ›´æ–°ã•ã‚Œã¦ã„ãŸãŒï¼Œ 1.16 ã‹ã‚‰ã¯ã“ã‚ŒãŒã§ããªããªã£ãŸã€‚ãŸã¨ãˆã°ï¼Œã‚½ãƒ¼ã‚¹ãƒ»ã‚³ãƒ¼ãƒ‰ä¸Šã§æ–°ã—ã„å¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ import ã—ã¦ã‚‚ go.mod ã¨ go.sum ã«è¨˜è¿°ãŒãªã„ã¨

```
$ go test ./...
main.go:9:2: no required module provides package github.com/spiegel-im-spiegel/cov19jpn/chart; to add it:
    go get github.com/spiegel-im-spiegel/cov19jpn/chart
```

ã¨ã‹

```
$ go test ./...
go: github.com/spiegel-im-spiegel/cov19jpn@v0.2.0: missing go.sum entry; to add it:
    go mod download github.com/spiegel-im-spiegel/cov19jpn
```

ã¿ãŸã„ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã‚Šã™ã‚‹ã€‚ go.mod ãŠã‚ˆã³ go.sum ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã„ã„æ„Ÿã˜ã«æ›´æ–°ã—ãŸã„ã®ã§ã‚ã‚Œã°

```
$ go mod tidy
```

ã¨ã™ã‚‹ã¨ã‚ˆã„ã€‚

### go ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’æ›´æ–°ã™ã‚‹

go mod tidy ã‚³ãƒãƒ³ãƒ‰ã« -go ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚‹ã“ã¨ã§ `go` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®šã‚’ä¸Šæ›¸ãã§ãã‚‹ã€‚

```
$ go mod tidy -go=1.17
```

ã¾ãŸ -go ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ä»£ã‚ã‚Šã« -compat ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚‹ã¨ `go` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã®å¤‰æ›´ã¯è¡Œã‚ãªã„ãŒï¼ŒæŒ‡å®šã—ãŸ [Go] ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ä»•æ§˜ã§å‡¦ç†ã•ã‚Œã‚‹ã€‚

```
$ go mod tidy -compat=1.17
```

ãªã‚“ã§ã“ã‚“ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒä»˜ã„ãŸã‹ã¨ã„ã†ã¨ [Go] 1.17 ã§ go mod tidy ã®å‡ºåŠ›çµæœãŒå¤§ããå¤‰ã‚ã‚‹ã‹ã‚‰ã ã€‚

### Module Graph Pruning

è¾æ›¸ã§å¼•ãã¨ prune ã¯æœ¨ã®æã®å‰ªå®šãªã‚“ã‹ã‚’æŒ‡ã™ã‚‰ã—ã„ãŒï¼Œä¸åº¦ã„ã„æ—¥æœ¬èªãŒãªã„ã‚ˆã†ã§ï¼Œ[ãƒªãƒªãƒ¼ã‚¹ãƒ‘ãƒ¼ãƒ†ã‚£](https://gocon.connpass.com/event/216361/ "Go 1.17 ãƒªãƒªãƒ¼ã‚¹ãƒ‘ãƒ¼ãƒ†ã‚£ - connpass")ã§ã‚‚ã€ŒåŸæ–‡ãƒãƒã€ã®è‹±èªã§ç´¹ä»‹ã•ã‚Œã¦ã„ãŸã€‚

ãŸã¨ãˆã°ï¼Œæ‹™ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® [spiegel-im-spiegel/cov19jpn](https://github.com/spiegel-im-spiegel/cov19jpn "spiegel-im-spiegel/cov19jpn: COVID-2019 in Japan; Importing Google COVID-19 Public Forecasts") v0.2.7 ã® go.mod ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã ãŒ

```markup:go.mod
module github.com/spiegel-im-spiegel/cov19jpn

go 1.16

require (
    github.com/spf13/cobra v1.2.1
    github.com/spiegel-im-spiegel/csvdata v0.1.1
    github.com/spiegel-im-spiegel/errs v1.0.4
    github.com/spiegel-im-spiegel/fetch v0.2.4
    github.com/spiegel-im-spiegel/gocli v0.10.4
    gonum.org/v1/plot v0.9.0
)
```

ã“ã‚Œã‚’ [Go] 1.17 ã§å‡¦ç†ã™ã‚‹ã¨

```
$ go mod tidy -go=1.17
$ cat go.mod
module github.com/spiegel-im-spiegel/cov19jpn

go 1.17

require (
    github.com/spf13/cobra v1.2.1
    github.com/spiegel-im-spiegel/csvdata v0.1.1
    github.com/spiegel-im-spiegel/errs v1.0.4
    github.com/spiegel-im-spiegel/fetch v0.2.4
    github.com/spiegel-im-spiegel/gocli v0.10.4
    gonum.org/v1/plot v0.9.0
)

require (
    github.com/ajstarks/svgo v0.0.0-20180226025133-644b8db467af // indirect
    github.com/fogleman/gg v1.3.0 // indirect
    github.com/go-fonts/liberation v0.1.1 // indirect
    github.com/go-latex/latex v0.0.0-20210118124228-b3d85cf34e07 // indirect
    github.com/golang/freetype v0.0.0-20170609003504-e2365dfdc4a0 // indirect
    github.com/inconshreveable/mousetrap v1.0.0 // indirect
    github.com/phpdave11/gofpdf v1.4.2 // indirect
    github.com/spf13/pflag v1.0.5 // indirect
    golang.org/x/image v0.0.0-20210216034530-4410531fe030 // indirect
    golang.org/x/text v0.3.5 // indirect
)
```

ã¨ã„ã£ãŸæ„Ÿã˜ã«æ›¸ãæ›ãˆã‚‰ã‚Œã‚‹ã€‚ã¡ãªã¿ã«ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¾å­˜é–¢ä¿‚ã¯

[![dependency.png](https://storage.googleapis.com/zenn-user-upload/9d9b6fa16a7cbcbe4d256263.png)](https://github.com/spiegel-im-spiegel/cov19jpn/blob/v0.2.7/dependency.png "cov19jpn/dependency.png at v0.2.7 Â· spiegel-im-spiegel/cov19jpn")

ã¨ã„ã†æ„Ÿã˜ã«ãªã£ã¦ã„ã¦ [Go] 1.17 ã® go mod tidy ã§é–“æ¥çš„ãªä¾å­˜ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚‚åˆ—æŒ™ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã€‚

Indirect ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æŒ‡å®šãŒãªã„å ´åˆï¼Œä¾å­˜ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã® go.mod ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†å¸°çš„ã«èª­ã¿è¾¼ã‚“ã§ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å«ã‚€ï¼‰ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æ±ºå®šã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚ 1.17 ã® go.mod ã§ã¯ï¼Œé–¢ç¯€ä¾å­˜ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æ˜è¨˜ã™ã‚‹ã“ã¨ã§ã“ã‚Œã‚’å›é¿ã—ã‚ˆã†ã¨ã„ã†ã“ã¨ã®ã‚ˆã†ã ã€‚ã ã‹ã‚‰ â€œpruningâ€ ãªã‚“ã ã­ã€‚

## [Semantic Versioning] ã«ã‚ˆã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ãƒªãƒã‚¸ãƒˆãƒªã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ç•ªå·ã¾ãŸã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¿ã‚°ã«ã‚ˆã£ã¦ç®¡ç†ã•ã‚Œã‚‹ãŒï¼Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¿ã‚°ã«é–¢ã—ã¦ã¯ [Semantic Versioning] ã®ãƒ«ãƒ¼ãƒ«ã«å‰‡ã£ã¦ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ã€‚

![research.swtch.com/impver.png](https://research.swtch.com/impver.png)
_[via â€œSemantic Import Versioningâ€](https://research.swtch.com/vgo-import "Semantic Import Versioning")_

ã“ã®ã‚ˆã†ã«å¾Œæ–¹äº’æ›æ€§ã®ãªã„å¤‰æ›´ãŒã‚ã‚‹å ´åˆã«ã¯ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ï¼Œå¾Œæ–¹äº’æ›æ€§ãŒæ‹…ä¿ã•ã‚ŒãŸå¤‰æ›´ã‚„è¿½åŠ ã«ã¤ã„ã¦ã¯ãƒã‚¤ãƒŠãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ï¼Œä¸å…·åˆã‚„è„†å¼±æ€§ã®ä¿®æ­£ã«ã¤ã„ã¦ã¯ç¬¬ 3 ä½ã®ãƒ‘ãƒƒãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸Šã’ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚ã¾ãŸãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸Šã’ã‚‹éš›ã«ã¯ï¼Œå›³ã®ã‚ˆã†ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ†é›¢ã™ã‚‹ã‹ï¼Œ go.mod ãƒ•ã‚¡ã‚¤ãƒ«ã® `module` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã®å€¤ã‚’å¤‰æ›´ã™ã‚‹ã®ãŒç°¡å˜ã§ã‚ã‚‹[^ver1]ã€‚

[^ver1]: v0 ã‹ã‚‰ v1 ã¸ã®ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã®å ´åˆã¯ä¾‹å¤–çš„ã«å¾Œæ–¹äº’æ›æ€§ã¯è€ƒæ…®ã•ã‚Œãªã„ã€‚ v0 ã¯ãƒ™ãƒ¼ã‚¿ç‰ˆã¨ã„ã†æ‰±ã„ã‚‰ã—ã„ã€‚ãã‚Œä»¥å¤–ã®ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã®éš›ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åï¼‹ãƒ‘ã‚¹ã§åŒºåˆ¥ã›ãšã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¿ã‚°ã‚’æ‰“ã¤ã¨å¼·åˆ¶çš„ã« `v2.0.0+incompatible` ã¿ãŸã„ãªã‚·ãƒ§ãƒœã„è¡¨è¨˜ã«ã•ã‚Œã‚‹ã€‚

ä»¥ä¸‹ã¯ [github.com/mattn/jvgrep](https://github.com/mattn/jvgrep) ã®ä¾‹ï¼š

```markup:go.mod
module github.com/mattn/jvgrep/v5
```

ã“ã®ã¨ãï¼Œã‚½ãƒ¼ã‚¹ãƒ»ã‚³ãƒ¼ãƒ‰å´ã‚‚

```go
import "github.com/mattn/jvgrep/v5/mmap"
```

ãªã©ã¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã‚’ãƒ™ãƒ¼ã‚¹ã«æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹[^pasth1]ã€‚

[^pasth1]: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.16 ã‹ã‚‰ import æ™‚ã®ç›¸å¯¾ãƒ‘ã‚¹æŒ‡å®šã¯åŸå‰‡ç¦æ­¢ã«ãªã£ãŸã®ã§æ³¨æ„ã€‚åŒä¸€ãƒªãƒã‚¸ãƒˆãƒªå†…ã«è¤‡æ•°ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚ã‚‹å ´åˆã¯ go.mod ãƒ•ã‚¡ã‚¤ãƒ«ã§ `replace` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’ä½¿ã†ã¨ã‚ˆã„ã€‚

## ç‰¹å®šãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒ“ãƒ«ãƒ‰&ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«&å®Ÿè¡Œã™ã‚‹

ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.16 ã‹ã‚‰ go install ã‚³ãƒãƒ³ãƒ‰ã§ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«@ãƒãƒ¼ã‚¸ãƒ§ãƒ³ ã‚’æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚

```markup
$ go install golang.org/x/tools/gopls@v0.6.5
```

go install ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œã«ã‚ˆã£ã¦ go.mod ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚‚å½±éŸ¿ã‚’ä¸ãˆã‚‹ã“ã¨ã¯ãªã„ã€‚

ã¨ã«ã‹ãæœ€æ–°ç‰ˆãŒæ¬²ã—ã„å ´åˆã¯

```markup
$ go install golang.org/x/tools/gopls@latest
go: downloading golang.org/x/tools/gopls v0.6.5
...
```

ãªã©ã¨ã™ã‚Œã° OKã€‚

ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä»˜ãã§æŒ‡å®šã™ã‚‹éš›ã¯ï¼Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã§æŒ‡å®šã™ã‚‹ç‚¹ã«æ³¨æ„ã€‚ãŸã¨ãˆã°ï¼Œå…ˆã»ã©ã® [github.com/mattn/jvgrep](https://github.com/mattn/jvgrep) ã®å ´åˆï¼Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¸ã®ç‰©ç†ãƒ‘ã‚¹ã§æŒ‡å®šã—ã¦ã‚‚

```
$ go install github.com/mattn/jvgrep@latest
go: downloading github.com/mattn/jvgrep v1.9.0
go: downloading github.com/mattn/jvgrep v5.8.1+incompatible
...
```

ã¦ãªæ„Ÿã˜ã§ `latest` ã‚’æŒ‡å®šã—ã¦ã‚‚æœ€æ–°ç‰ˆã‚’å–ã£ã¦ãã‚Œãªã„ã€‚ã“ã†ã„ã†ã¨ãã¯

```
$ go install github.com/mattn/jvgrep/v5@latest
go: downloading github.com/mattn/jvgrep/v5 v5.8.9
...
```

ã¨ã™ã‚Œã°ç„¡å•é¡Œã§ã‚ã‚‹ã€‚

æ›´ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.17 ã‹ã‚‰ go run ã‚³ãƒãƒ³ãƒ‰ã§ã‚‚ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«@ãƒãƒ¼ã‚¸ãƒ§ãƒ³ ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ã‚ã‚‰ã‹ã˜ã‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ã¯ãªã go.mod ãƒ•ã‚¡ã‚¤ãƒ«ã«å½±éŸ¿ã‚’ä¸ãˆãªã„ã€‚

```
$ go run github.com/mattn/jvgrep/v5@latest --version
5.8.9
```

ã“ã® go run ã®ä½¿ã„æ–¹ã¯ `//go:generate` ã§ã‚‚ä½¿ãˆã‚‹ã‚‰ã—ã„ã€‚ GitHub Actions ã‚„ä»–ã® CI/CD ã§ã‚‚è‰²ã€…ã¨å¿œç”¨ãŒåŠ¹ããã†ã§ã‚ã‚‹ã€‚

:::details ã“ã®é …ç›®ã¯æ¤œè¨¼ã—ãã‚Œã¦ãªã„ã®ã§ä¿ç•™
ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.16 ãŠã‚ˆã³ 1.17 ã§ã¯ go.mod ãƒ•ã‚¡ã‚¤ãƒ«ã« `replace` ã‚„ `exclude` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã¨ go install ã«å¤±æ•—ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã¿ãŸã„ã€‚

```
$ go install github.com/spiegel-im-spiegel/gnkf@v0.3.0
go: downloading github.com/spiegel-im-spiegel/gnkf v0.3.0
go install: github.com/spiegel-im-spiegel/gnkf@v0.3.0 (in github.com/spiegel-im-spiegel/gnkf@v0.3.0):
	The go.mod file for the module providing named packages contains one or
	more replace directives. It must not contain directives that would cause
	it to be interpreted differently than if it were the main module.
```

ã¨ã»ã» orz

ã“ã†ã„ã†ã¨ãã¯ go install ã§ã¯ãªã go get ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ãˆã°å–ã‚Šæ•¢ãˆãšå¤§ä¸ˆå¤«ãªã‚ˆã†ã ï¼ˆãŸã ã— [Go] 1.17 ã§ã¯è­¦å‘ŠãŒå‡ºã‚‹ï¼‰ã€‚

```
$ go get github.com/spiegel-im-spiegel/gnkf@v0.3.0
go get: installing executables with 'go get' in module mode is deprecated.
	Use 'go install pkg@version' instead.
	For more information, see https://golang.org/doc/go-get-install-deprecation
	or run 'go help get' or 'go help install'.
```
:::

## go get ã¯ã‚ªãƒ¯ã‚³ãƒ³ï¼Ÿ

go install ãŠã‚ˆã³ go run ã®æ©Ÿèƒ½æ‹¡å¼µã®ä»£ã‚ã‚Šã« go get ã¯æ©Ÿèƒ½åˆ¶é™ã•ã‚Œã‚‹äºˆå®šã§ã‚ã‚‹ã€‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.17 ã§ã¯è­¦å‘Šã®ã¿ã ãŒï¼Œ 1.18 ã‹ã‚‰ã¯ go get ã«ã‚ˆã‚‹ãƒ“ãƒ«ãƒ‰&ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ã§ããªããªã‚‹ãã†ã ï¼ˆgo get -u ç›¸å½“ã®æ©Ÿèƒ½ã«é™å®šï¼‰ã€‚

```
$ go version
go version go1.17 linux/amd64

$ go get github.com/mattn/jvgrep/v5@latest
go get: installing executables with 'go get' in module mode is deprecated.
    Use 'go install pkg@version' instead.
    For more information, see https://golang.org/doc/go-get-install-deprecation
    or run 'go help get' or 'go help install'.
```

go get ã‚³ãƒãƒ³ãƒ‰ã¯å…ƒã€… $GOPATH ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸‹ã«æŒ‡å®šã—ãŸå¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’çµ„ã¿è¾¼ã‚€ãŸã‚ã®ä»•çµ„ã¿ã§ã‚ã‚‹ã€‚

æ—§æ¥ã® GOPATH ãƒ¢ãƒ¼ãƒ‰ã§ã¯ go get ã§å¸¸ã«æœ€æ–°ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ $GOPATH ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸‹ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã‚ˆã†ã¨ã™ã‚‹ãŸã‚ã€Œ[GOPATH æ±šæŸ“](https://text.baldanders.info/golang/gopath-pollution/)ã€ã®å•é¡ŒãŒã¤ãã¾ã¨ã£ã¦ã„ãŸã€‚ç¾åœ¨ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¯¾å¿œãƒ¢ãƒ¼ãƒ‰ã¯ã“ã®å•é¡Œã‚’æ ¹æœ¬çš„ã«è§£æ±ºã™ã‚‹ãŸã‚ã®ã‚‚ã®ã¨è¨€ãˆã‚‹ã€‚

ã—ã‹ã—ãã®çµæœï¼Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¯¾å¿œãƒ¢ãƒ¼ãƒ‰ã§ã¯ go get ã‚³ãƒãƒ³ãƒ‰ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ã ã‘ã®ã‚³ãƒãƒ³ãƒ‰ã«ãªã£ã¦ã—ã¾ã£ãŸã€‚ã—ã‹ã‚‚ go.mod & go.sum ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ„å›³ã›ãšæ›¸ãæ›ãˆã¦ã—ã¾ã†å±é™ºãŒã‚ã‚‹ã€‚

é–‹ç™ºä¸­ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ãŠã„ã¦ï¼Œæ„å›³çš„ã«ï¼ˆä¾å­˜ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å«ã‚€ï¼‰å¤–éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®èª­ã¿è¾¼ã¿ã¨ go.mod & go.sum ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°ã‚’è¡Œã„ãŸã„ã®ã§ã‚ã‚Œã° go mod tidy ã§ä¸€æ‹¬å‡¦ç†ã™ã‚‹ã»ã†ãŒä¾¿åˆ©ã§ã‚ã‚‹ã€‚ GOPATH ãƒ¢ãƒ¼ãƒ‰ãŒå¾Œæ–¹äº’æ›æ©Ÿèƒ½ã¨ã—ã¦æ®‹ã•ã‚Œã¦ã„ã‚‹é–“ã¯ go get ã‚³ãƒãƒ³ãƒ‰è‡ªä½“ã‚‚ãªããªã‚‰ãªã„ã ã‚ã†ãŒï¼Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¯¾å¿œãƒ¢ãƒ¼ãƒ‰ãŒä¸»æµã¨ãªã‚‹ä»Šå¾Œã¯ãƒ¦ãƒ¼ã‚¶ãŒæ‰‹æ‰“ã¡ã§ go get ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã“ã¨ã¯ãªããªã£ã¦ãã‚‹ã‚“ã˜ã‚ƒãªã„ã ã‚ã†ã‹ã€‚

## å‚è€ƒ

https://golang.org/ref/mod
https://golang.org/doc/modules/developing
https://blog.golang.org/go116-module-changes
https://zenn.dev/nobonobo/articles/4fb018a24f9ee9
https://future-architect.github.io/articles/20210810a/
https://future-architect.github.io/articles/20210818a/

[go]: https://golang.org/ "The Go Programming Language"
[git]: https://git-scm.com/ "Git"
[semantic versioning]: http://semver.org/ "Semantic Versioning 2.0.0 | Semantic Versioning"
[github]: https://github.com/
