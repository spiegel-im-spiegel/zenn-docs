---
title: "ã¯ã˜ã‚ã¦ã® Go è¨€èª (on Windows) ãã®7"
emoji: "ğŸ˜€"
type: "tech"
topics: [Go,testing,TravisCI]
published: false
---
ï¼ˆ[ã“ã‚Œã¾ã§ã®è¨˜äº‹ã®ç›®æ¬¡](http://qiita.com/spiegel-im-spiegel/items/dca0df389df1470bdbfa#%E7%9B%AE%E6%AC%A1)ï¼‰

[å‰å›](http://qiita.com/spiegel-im-spiegel/items/404871d2bafd22bdbb90)ã®ç¶šãã€‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã¾ã§ã—ãŸã®ãªã‚‰ãƒ†ã‚¹ãƒˆã¾ã§è¡Œã£ã¡ã‚ƒãŠã†ã‹ã¨ã€‚

## ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã

ãã‚‚ãã‚‚ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå‰ã«å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ããªã‚“ã¦ã®ã¯é‚ªé“ãªã®ã§ã™ãŒï¼Œä»Šã¾ã§ã€Œæ­£ã—ãå‹•ã‹ã™ã€ã“ã¨ã¯ã‚ã¾ã‚Šæ„è­˜ã—ã¦ãªã‹ã£ãŸã®ã§ã€‚ã‚´ãƒ¡ãƒ³ãƒšã‚³ãƒ³ã€‚

Go è¨€èªã§ã¯æœ€åˆã‹ã‚‰ãƒ†ã‚¹ãƒˆãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒåŒæ¢±ã•ã‚Œã¦ã„ã¾ã™ã€‚æœ€è¿‘ã®è¨€èªã¯ã¿ã‚“ãªãã†ã§ã™ã‚ˆã­ã€‚ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã«ã¯å¯¾è±¡ã®ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã« `*_test.go` ã¨ã„ã†åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¾ã™ã€‚ã¾ãï¼Œèª¬æ˜ã™ã‚‹ã‚ˆã‚Šæ›¸ã„ãŸæ–¹ãŒæ—©ã„ã§ã™ã­ã€‚

```go:modjulian_test.go
package modjulian

import (
	"os"
	"testing"
	"time"
)

type mjdnTest struct { //test case for DayNumber
	in time.Time //input data
	out int64 //expected result
}

var mjdnTests []mjdnTest  //test cases for DayNumber

func TestMain(m *testing.M) {
	//initialization
 	mjdnTests = []mjdnTest {  //test cases for DayNumber
		{time.Date(1969, 12, 31, 0, 0, 0, 0, time.UTC), int64(40586)},
		{time.Date(1970,  1,  1, 0, 0, 0, 0, time.UTC), int64(40587)},
		{time.Date(2015,  1,  1, 0, 0, 0, 0, time.UTC), int64(57023)},
	}

	//start test
    code := m.Run()

	//termination
    os.Exit(code)
}

func TestModifiedJulianDayNumber(t *testing.T) {
	for _, testCase := range mjdnTests {
		result := DayNumber(testCase.in)
		if result != testCase.out {
			t.Errorf("DayNumber of \"%v\" = %d, want %d.", testCase.in, result, testCase.out)
		}
	}
}
```

1. `package` ã«ã¯ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æŒ‡å®šã—ã¾ã™ã€‚
1. `import` ã«ã¯ [testing](http://golang.org/pkg/testing/) ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å«ã‚ã¾ã™ã€‚
1. `Test...` ã§å§‹ã¾ã‚‹é–¢æ•°åãŒãƒ†ã‚¹ãƒˆå®Ÿè¡Œç”¨ã®é–¢æ•°ã§ã™ã€‚å¼•æ•°ã«ã¯ `t *testing.T` ã‚’æŒ‡å®šã—ã¾ã™ã€‚
1. `TestMain()` ã¯ç‰¹åˆ¥ãªé–¢æ•°ã§ã™ã€‚ãƒ†ã‚¹ãƒˆã®æœ€åˆã«å‘¼ã³å‡ºã•ã‚Œï¼Œ `Run()` ã§ä»–ã®ãƒ†ã‚¹ãƒˆé–¢æ•°ï¼ˆç¾¤ï¼‰ã‚’ã‚­ãƒƒã‚¯ã—ã¾ã™ã€‚å¼•æ•°ã«ã¯ `m *testing.M` ã‚’æŒ‡å®šã—ã¾ã™ã€‚ `TestMain()` å†…ã§åˆæœŸåŒ–ã‚„æ¡ä»¶ã‚’å¤‰ãˆãŸãƒ†ã‚¹ãƒˆã®ç¹°ã‚Šè¿”ã—ã‚„å¾Œå§‹æœ«å‡¦ç†ãªã©ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

[testing](http://golang.org/pkg/testing/) ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã¯ï¼Œä»–ã®è¨€èªã®ãƒ†ã‚¹ãƒˆãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã‚ˆãã‚ã‚‹ [assertion é–¢æ•°ãŒã‚ã‚Šã¾ã›ã‚“](http://golang.jp/go_faq#assertions)ã€‚ [FAQ](http://golang.jp/go_faq#testing_framework) ã«ã‚ˆã‚‹ã¨

> ä¸€èˆ¬çš„ãªãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ãŠã„ã¦æ¡ä»¶ãƒ»åˆ¶å¾¡ãƒ»å‡ºåŠ›æ©Ÿæ§‹ã‚’æŒã¤å°‚ç”¨ã®ãƒŸãƒ‹è¨€èªãŒç”¨æ„ã•ã‚Œã‚‹å‚¾å‘ãŒã‚ã‚Šã¾ã™ãŒã€Goè¨€èªã«ã¯ã™ã§ã«ã“ã‚Œã‚‰ãŒå‚™ã‚ã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã‚’å†ã³ä½œæˆã™ã‚‹ã‚ˆã‚Šã€æˆ‘ã€…ã¯Goè¨€èªã®ãƒ†ã‚¹ãƒˆã‚’é€²ã‚ãŸã‹ã£ãŸã®ã§ã™ã€‚ã“ã®ã‚ˆã†ã«ã—ãŸã“ã¨ã§ä½™è¨ˆãªè¨€èªã‚’è¦šãˆã‚‹å¿…è¦ãŒãªããªã‚Šã€ãƒ†ã‚¹ãƒˆã‚’ç›´æ¥çš„ã‹ã¤ç†è§£ã—ã‚„ã™ãã—ã¦ã„ã¾ã™ã€‚

ã¨ã‚ã‚Šã¾ã™ã€‚ãƒ†ã‚¹ãƒˆé§†å‹•å‹é–‹ç™ºã®å ´åˆï¼Œãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã¯ãã‚Œè‡ªä½“ãŒè¨­è¨ˆæ›¸ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã®ã§ï¼Œã“ã®å‰²ã‚Šåˆ‡ã‚Šã¯å¦¥å½“ã¨è¨€ãˆã¾ã™[^1]ã€‚ãã®ä»£ã‚ã‚Šãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã—ã¦ï¼‰ãã¡ã‚“ã¨æ›¸ãã®ã¯éª¨ãŒæŠ˜ã‚Œã¾ã™ãŒï¼ˆç¬‘ï¼‰

[^1]: ç§ã¯çµ„ã¿è¾¼ã¿ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãªã®ã§ï¼Œãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§ assert ã‚’å¤šç”¨ã™ã‚‹ã®ã¯ï¼Œã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®æ€ æ…¢ã ã¨æ€ã£ã¦ã—ã¾ã„ã¾ã™ã€‚ã¾ãï¼Œãƒ™ã‚¯ã‚¿ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ã‚´ãƒªã‚´ãƒªæ›¸ãã£ã¦ã®ãªã‚‰åˆ¥ã§ã™ãŒã€‚

ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒæ›¸ã‘ãŸã®ã§æ—©é€Ÿå‹•ã‹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ãƒ†ã‚¹ãƒˆã‚’è¡Œã†ã«ã¯ `test` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã„ã¾ã™ã€‚ã¾ãŸå¼•æ•°ã« `./...` ã¨æŒ‡å®šã™ã‚Œã°ã‚«ãƒ¬ãƒ³ãƒˆãƒ»ãƒ•ã‚©ãƒ«ãƒ€ä»¥ä¸‹ã®å…¨ã¦ã®ãƒ†ã‚¹ãƒˆãŒå¯¾è±¡ã«ãªã‚Šã¾ã™ã€‚

```shell
C:>go test -v ./...
=== RUN TestModifiedJulianDayNumber
--- PASS: TestModifiedJulianDayNumber (0.00s)
PASS
ok      _/C_/pathto/astrocalc/modjulian 0.255s
```

ã“ã‚Œã¯æˆåŠŸä¾‹ã€‚ã˜ã‚ƒã‚ï¼Œ[å…ƒã®ã‚³ãƒ¼ãƒ‰](https://github.com/spiegel-im-spiegel/astrocalc/blob/master/modjulian/modjulian.go)ã‚’å°‘ã—ã„ã˜ã£ã¦ã‚ã–ã¨å¤±æ•—ã•ã›ã¦ã¿ã¾ã—ã‚‡ã†ã‹ï¼ˆãªã‚“ã ã‹ãªãï¼‰ã€‚

```shell
C:\home\spiegel\docs\docs-baldanders\wiki\Draft\golang-src\astrocalc>go test -v ./...
=== RUN TestModifiedJulianDayNumber
--- FAIL: TestModifiedJulianDayNumber (0.00s)
        modjulian_test.go:35: DayNumber of "1969-12-31 00:00:00 +0000 UTC" = 40585, want 40586.
FAIL
exit status 1
FAIL    _/C_/pathto/astrocalc/modjulian 1.729s
```

ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆã‚’åã `Errorf()` ã¯å†…éƒ¨ã§ `Fail()` ã‚’å‘¼ã³å‡ºã—ï¼Œãƒ†ã‚¹ãƒˆè‡ªä½“ã¯ç¶šè¡Œã—ã¾ã™ã€‚ä¸€æ–¹ `Errorf()` ã®ä»£ã‚ã‚Šã« `Fatalf()` ã‚’ä½¿ã†ã¨ï¼Œå†…éƒ¨ã§ `FailNow()` ã‚’å‘¼ã³å‡ºã—ãƒ†ã‚¹ãƒˆã‚’ä¸­æ–­ã—ã¾ã™ã€‚

Go è¨€èªã®ãƒ†ã‚¹ãƒˆãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ benchmark ã‚„ coverage ã‚‚ã‚µãƒãƒ¼ãƒˆã—ã¦ã¾ã™ãŒï¼Œä»Šå›ã¯å‰²æ„›ã—ã¾ã™ã€‚

## ãƒ†ã‚¹ãƒˆã®è‡ªå‹•åŒ–ï¼ˆContinuous Integrationï¼‰

ä»Šå›ã®ã‚³ãƒ¼ãƒ‰ã¯è‡ªå‹•åŒ–ã™ã‚‹ã»ã©ã®è¦æ¨¡ã§ã‚‚ãªã„ã§ã™ãŒï¼Œè©±ã®ã¤ã„ã§ã« [Travis CI] ã§è‡ªå‹•åŒ–ã—ã¡ã‚ƒã„ã¾ã—ã‚‡ã†ã€‚ãˆã£ã¨ï¼Œä»Šå›ã¯ [Travis CI] ã®èª¬æ˜ã¯å‰²æ„›ã—ã¾ã™ã€‚ãƒãƒƒãƒˆã«ã„ãã‚‰ã§ã‚‚è§£èª¬ãŒè»¢ãŒã£ã¦ã¾ã™ã—ã€‚

ãƒ†ã‚¹ãƒˆã‚’è¡Œã†ã ã‘ãªã‚‰ .travis.yml ã®è¨˜è¿°ã¯è¶…ç°¡å˜ã§ã™ã€‚

```yaml:.travis.yml
language: go

go:
  - 1.4

script:
 - go test -v ./...
```

å®Ÿè¡Œçµæœã¯[ã“ã“](https://travis-ci.org/spiegel-im-spiegel/astrocalc)ã‚’å‚ç…§ã—ã¦ä¸‹ã•ã„ã€‚

[Travis CI]: https://travis-ci.org/ "Travis CI - Test and Deploy Your Code with Confidence"

## ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯

- [Go ã® Test ã«å¯¾ã™ã‚‹è€ƒãˆæ–¹ - Qiita](http://qiita.com/Jxck_/items/8717a5982547cfa54ebc)
- [Goã§ãƒ†ã‚¹ãƒˆã‚’æ›¸ã - æˆã‚‰ã¬ã¯äººã®ç‚ºã•ã¬ãªã‚Šã‘ã‚Š](http://straitwalk.hatenablog.com/entry/2014/09/18/232810)
- [golang 1.4ã§è¿½åŠ ã•ã‚ŒãŸtestingã®ä¾¿åˆ©æ©Ÿèƒ½(ãƒ†ã‚¹ãƒˆã®åˆæœŸåŒ–ã¨ãŠç‰‡ã¥ã‘) - Qiita](http://qiita.com/umisama/items/0d589cca7e89b89c29a8)
- [Go + Travis CI + Coveralls ã§CIç’°å¢ƒã‚’ä½œã‚‹ - Qiita](http://qiita.com/dmnlk/items/3fb4e0abb98e39fee275)
- [Githubã«ã‚ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã‚’Travis CIé€£æºã™ã‚‹æ‰‹é † #junitbook - ãã‚Šã«ã£ã](http://sue445.hatenablog.com/entry/2013/06/01/170607)
- [CI-as-a-Serviceã§Goè¨€èªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æœ€æ–°ãƒ“ãƒ«ãƒ‰ã‚’ç¶™ç¶šçš„ã«æä¾›ã™ã‚‹ | SOTA](http://deeeet.com/writing/2014/10/16/golang-in-ci-as-a-service/)
- [golangã§Travis CIã‚’ä½¿ã£ã¦ã‚¯ãƒ­ã‚¹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã¨ãã«ãƒãƒã£ãŸã¨ã“ã‚ #golang #travisci - uchimanajet7ã®ãƒ¡ãƒ¢](http://uchimanajet7.hatenablog.com/entry/2015/03/20/211352)
- [Goè¨€èªã®ãƒ“ãƒ«ãƒ‰ç”Ÿæ´»ã‚’ drone.ioã§å¹¸ã›ã«æš®ã‚‰ã™ #golang - Qiita](http://qiita.com/atotto/items/b796c31c1755dbec13db)

## è„šæ³¨

