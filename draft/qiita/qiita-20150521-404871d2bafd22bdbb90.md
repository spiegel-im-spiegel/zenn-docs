---
title: "ã¯ã˜ã‚ã¦ã® Go è¨€èª (on Windows) ãã®6"
emoji: "ğŸ˜€"
type: "tech"
topics: [Go]
published: false
---
ï¼ˆ[ã“ã‚Œã¾ã§ã®è¨˜äº‹ã®ç›®æ¬¡](http://qiita.com/spiegel-im-spiegel/items/dca0df389df1470bdbfa#%E7%9B%AE%E6%AC%A1)ï¼‰

[å‰å›](http://qiita.com/spiegel-im-spiegel/items/e743d63ef5165d750eff)ã®ãƒ¦ãƒªã‚¦ã‚¹æ—¥ã®ç¶šãã€‚ãªã‚“ã ã‘ã©ã€ä»Šå›ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãŠè©±ã€‚

## ãƒ¦ãƒªã‚¦ã‚¹æ—¥è¨ˆç®—é–¢æ•°ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã™ã‚‹

ãƒ¦ãƒªã‚¦ã‚¹æ—¥ã®è¨ˆç®—ãªã‚“ã¦ç°¡å˜ãªã®ã§ä»Šã¾ã§ `main()` ã®ä¸­ã«ã‚´ãƒªã‚´ãƒªæ›¸ã„ã¦ãŸã‚“ã ã‘ã©ã€ä»Šå¾Œã®ã“ã¨ã‚’è€ƒãˆã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã‚’è¡Œã†ã“ã¨ã«ã—ã¾ã™ã€‚

ã¾ãšã¯ã€[å‰å›](http://qiita.com/spiegel-im-spiegel/items/e743d63ef5165d750eff)ã®ã‚³ãƒ¼ãƒ‰ã‹ã‚‰è¨ˆç®—å‡¦ç†éƒ¨åˆ†ã‚’ãã¡ã‚“ã¨åˆ†é›¢ã—ã¾ã™ã€‚

```go:jd4.go
package main

import (
	"flag"
	"fmt"
	"strconv"
	"time"
)

func ModifiedJulianDayNumber(t time.Time) int64 {
	if t.Sub(time.Unix(0, 0)) >= 0 {
		return mjdnUnix(t)
	} else {
		return mjdnGregorian(t)
	}
}

func mjdnGregorian(t time.Time) int64 {
	y := int64(t.Year())
	m := int64(t.Month())
	if m < 3 {
		y -= 1
		m += 9
	} else {
		m -= 3
	}
	d := int64(t.Day()) - 1
	return (1461*y)/4 + y/400 - y/100 + (153*m+2)/5 + d - 678881
}

func mjdnUnix(t time.Time) int64 {
	const (
		onday   = int64(86400) //seconds
		baseDay = int64(40587) //Modified Julian Date at January 1, 1970
	)
	return (t.Unix())/onday + baseDay
}

func main() {
	//å¼•æ•°ã®ãƒã‚§ãƒƒã‚¯
	flag.Parse()
	argsStr := flag.Args()
	if len(argsStr) < 3 {
		fmt.Printf("å¹´æœˆæ—¥ã‚’æŒ‡å®šã—ã¦ãã ã•ã„")
		return
	}
	args := make([]int, 3)
	for i := 0; i < 3; i++ {
		num, err := strconv.Atoi(argsStr[i])
		if err != nil {
			if enum, ok := err.(*strconv.NumError); ok {
				switch enum.Err {
				case strconv.ErrRange:
					fmt.Printf("Bad Range Error")
				case strconv.ErrSyntax:
					fmt.Printf("Syntax Error")
				}
			}
			return
		} else {
			args[i] = num
		}
	}
	tm := time.Date(args[0], time.Month(args[1]), args[2], 0, 0, 0, 0, time.UTC)
	fmt.Printf("%v\n", tm)
	fmt.Printf("MJD = %dæ—¥\n", ModifiedJulianDayNumber(tm))
}
```

```shell
C:>go run jd4.go 1969 12 31
1969-12-31 00:00:00 +0000 UTC
MJD = 40586æ—¥

C:>go run jd4.go 1970 1 1
1970-01-01 00:00:00 +0000 UTC
MJD = 40587æ—¥

C:>go run jd4.go 2015 1 1
2015-01-01 00:00:00 +0000 UTC
MJD = 57023æ—¥
```

ãƒ¦ãƒªã‚¦ã‚¹æ—¥ã®ç«¯æ•°ãŒé¬±é™¶ã—ã„ã®ã§ä¿®æ­£ãƒ¦ãƒªã‚¦ã‚¹æ—¥ã®æ•´æ•°éƒ¨åˆ†ã®ã¿è¨ˆç®—ã—ã¦ã„ã¾ã™[^1]ã€‚ã‚ã¨1970å¹´1æœˆ1æ—¥ã‚’å¢ƒç•Œã¨ã—ã¦è¨ˆç®—æ–¹æ³•ã‚’å¤‰ãˆã¦ã„ã¾ã™ã€‚æœ¬å½“ã¯ãƒ¦ãƒªã‚¦ã‚¹æš¦ã®å ´åˆã®è¨ˆç®—ã‚‚å«ã‚ã‚‹ã¹ããªã‚“ã§ã—ã‚‡ã†ã‘ã©ã€ä»Šå›ã¯ç„¡è¦–ã€‚

[^1]: ã¡ãªã¿ã«1æ—¥æœªæº€ã®ç«¯æ•°ã‚’å«ã‚€å ´åˆã‚’ã€Œãƒ¦ãƒªã‚¦ã‚¹æ—¥ï¼ˆJulian Dateï¼‰ã€ã€ç«¯æ•°ã‚’å«ã¾ãªã„å ´åˆã‚’ã€Œãƒ¦ãƒªã‚¦ã‚¹é€šæ—¥ï¼ˆJulian Day Numberï¼‰ã€ã¨å‘¼ã³åˆ†ã‘ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

ã•ã¦ä¸Šã®ã‚³ãƒ¼ãƒ‰ã®ã†ã¡ä¿®æ­£ãƒ¦ãƒªã‚¦ã‚¹æ—¥è¨ˆç®—é–¢æ•°ã‚’åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«ã—ã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã—ã¾ã™ã€‚

```go:modjulian.go
package modjulian

import "time"

func DayNumber(t time.Time) int64 {
	if t.Sub(time.Unix(0, 0)) >= 0 {
		return dnUnix(t)
	} else {
		return dnGregorian(t)
	}
}

func dnGregorian(t time.Time) int64 {
	y := int64(t.Year())
	m := int64(t.Month())
	if m < 3 {
		y -= 1
		m += 9
	} else {
		m -= 3
	}
	d := int64(t.Day()) - 1
	return (1461*y)/4 + y/400 - y/100 + (153*m+2)/5 + d - 678881
}

func dnUnix(t time.Time) int64 {
	const (
		onday   = int64(86400) //seconds
		baseDay = int64(40587) //Modified Julian Date at January 1, 1970
	)
	return (t.Unix())/onday + baseDay
}
```

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¯ `modjulian` ã¨ã—ã¾ã—ãŸã€‚ã¡ãªã¿ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…ã®é–¢æ•°ç­‰ã¯åå‰ã®å…ˆé ­ãŒå¤§æ–‡å­—ã®ã‚‚ã®ã ã‘ãŒå¤–éƒ¨ã‹ã‚‰å‚ç…§å¯èƒ½ã§ã™ã€‚

### Go è¨€èªã«ãŠã‘ã‚‹åå‰ã®å•é¡Œ

Go è¨€èªãŠã‚ˆã³ãã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¯åå‰ã«ã†ã‚‹ã•ã„ã‚ˆã†ã§ã™ã€‚ãŸã¨ãˆã°ã€Œ[å®Ÿè·µGoè¨€èª](http://golang.jp/effective_go)ã€ã«ã‚ˆã‚‹ã¨

> æ…£ä¾‹ã§ã¯ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¯å°æ–‡å­—ã§ã²ã¨ã¤ã®å˜èªã§ã™ã€‚ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã‚„å¤§æ–‡å­—ãŒæ··ã–ã£ã¦(mixedCaps)ã¯ã„ã‘ã¾ã›ã‚“ã€‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½¿ç”¨è€…ãŒãã®åå‰ã‚’ã‚¿ã‚¤ãƒ—ã™ã‚‹ã“ã¨ã‚’è€ƒæ…®ã—ã¦ã€ç°¡æ½”ã™ãã‚‹ãã‚‰ã„ã«ã—ã¦ãã ã•ã„ã€‚

ãªã‚“ã ãã†ã§ã€æœ¬å½“ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚’ `julianDate` ã¨ã—ãŸã‹ã£ãŸã‚“ã ã‘ã©ã€ãã‚Œã˜ã‚ƒã ã‚ã‚‰ã—ã„ã€‚

ã‚‚ã†ã²ã¨ã¤ã€‚

> ã‚‚ã†ä¸€ã¤ã®æ…£ä¾‹ã¯ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åãŒãã®ã‚½ãƒ¼ã‚¹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ™ãƒ¼ã‚¹åã§ã‚ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚ãŸã¨ãˆã°src/pkg/encoding/base64ã«ç½®ã‹ã‚Œã¦ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã€"encoding/base64"ã¨ã—ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã€åå‰ã¯base64ã¨ãªã‚Šã¾ã™ã€‚encoding_base64ã‚„encodingBase64ã¨ã¯ãªã‚Šã¾ã›ã‚“ã€‚

ãªã®ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æŒ‡å®šã¯ãƒãƒ³ã‚¬ãƒªã‚¢ãƒ³è¨˜æ³•ã¨ã‹ã§ã¯ãªãå˜èªã‚’ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§åŒºåˆ‡ã£ã¦éšå±¤åŒ–ã™ã‚‹ã“ã¨ã§æ•´ç†ã§ããã†ã§ã™ã€‚ã“ã‚Œã£ã¦ Java ã¨ã‹ã«æ…£ã‚Œã¦ã‚‹äººã«ã¯æ¯”è¼ƒçš„ã¨ã£ã¤ãã‚„ã™ãä»•çµ„ã¿ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

> é•·ã„åå‰ã¯ã€æ…£ã‚ŒãŸã¨ã—ã¦ã‚‚èª­ã¿ã‚„ã™ããªã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è¤‡é›‘ã‚‚ã—ãã¯å¾®å¦™ãªãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ã‚’æŒã¤ã‚‚ã®ã«åå‰ã‚’ã¤ã‘ã‚‹ã¨ãã¯ã€ã™ã¹ã¦ã®æƒ…å ±ã‚’åå‰ã§è¡¨ç¾ã—ã‚ˆã†ã¨ã™ã‚‹ã‚ˆã‚Šã€é€šå¸¸ã¯å½¹ç«‹ã¤ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã„ãŸã»ã†ãŒã‚ˆã„ã§ã—ã‚‡ã†ã€‚

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®é…ç½®ã¨å‘¼ã³å‡ºã—

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å‘¼ã³å‡ºã™ã®ã«ã¯ï¼ˆæ¨™æº–ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨åŒã˜ãï¼‰ `import` ã‚’ä½¿ãˆã°ã„ã„ã®ã§ã™ãŒã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¨˜è¿°ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã©ã“ã«é…ç½®ã™ã‚‹ã‹ã§å¤šå°‘è¨˜è¿°ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚

ãŸã¨ãˆã°

```go
import "./modjulian"
```

ã¨è¨˜è¿°ã—ãŸå ´åˆã¯ã€å‘¼ã³å‡ºã—å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ã«ã‚ã‚‹ `modjulian` ãƒ•ã‚©ãƒ«ãƒ€ã‚’æ¢ã—ã¾ã™ã€‚ä¸€æ–¹

```go
import "modjulian"
```

ã¨è¨˜è¿°ã—ãŸå ´åˆã«ã¯ã€ç’°å¢ƒå¤‰æ•° `GOROOT` ãŠã‚ˆã³ `GOPATH` ã§æŒ‡å®šã•ã‚Œã‚‹ãƒ•ã‚©ãƒ«ãƒ€ä»¥ä¸‹ã‚’æ¢ã™ã‚ˆã†ã§ã™ã€‚ 

```shell
C:>go run jd4c.go 1969 12 31
jd4c.go:4:2: cannot find package "modjulian" in any of:
        C:\goroot\src\modjulian (from $GOROOT)
        C:\gopath\src\modjulian (from $GOPATH)
```

ã¾ãšã¯å‰è€…ã§è¡Œãã¾ã—ã‚‡ã†ã€‚ã‚«ãƒ¬ãƒ³ãƒˆãƒ»ãƒ•ã‚©ãƒ«ãƒ€ã« `modjulian` ãƒ•ã‚©ãƒ«ãƒ€ã‚’æ˜ã£ã¦ã€å…ˆã»ã©ã® `modjulian.go` ã‚’å…¥ã‚Œã¾ã™ã€‚å‘¼ã³å‡ºã—å´ã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```go:jd4b.go
package main

import (
	"./modjulian"
	"flag"
	"fmt"
	"strconv"
	"time"
)

func main() {
	//å¼•æ•°ã®ãƒã‚§ãƒƒã‚¯
	flag.Parse()
	argsStr := flag.Args()
	if len(argsStr) < 3 {
		fmt.Printf("å¹´æœˆæ—¥ã‚’æŒ‡å®šã—ã¦ãã ã•ã„")
		return
	}
	args := make([]int, 3)
	for i := 0; i < 3; i++ {
		num, err := strconv.Atoi(argsStr[i])
		if err != nil {
			if enum, ok := err.(*strconv.NumError); ok {
				switch enum.Err {
				case strconv.ErrRange:
					fmt.Printf("Bad Range Error")
				case strconv.ErrSyntax:
					fmt.Printf("Syntax Error")
				}
			}
			return
		} else {
			args[i] = num
		}
	}
	tm := time.Date(args[0], time.Month(args[1]), args[2], 0, 0, 0, 0, time.UTC)
	fmt.Printf("%v\n", tm)
	fmt.Printf("MJD = %dæ—¥\n", modjulian.DayNumber(tm))
}
```

```shell
C:>go run jd4b.go 1969 12 31
1969-12-31 00:00:00 +0000 UTC
MJD = 40586æ—¥

C:>go run jd4b.go 1970 1 1
1970-01-01 00:00:00 +0000 UTC
MJD = 40587æ—¥

C:>go run jd4b.go 2015 1 1
2015-01-01 00:00:00 +0000 UTC
MJD = 57023æ—¥
```

åŒã˜çµæœãŒå¾—ã‚‰ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚

### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ GitHub ä¸Šã«é…ç½®ã™ã‚‹

ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã«ã‚ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ `import` ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ã“ã®å ´åˆã€ä»¥ä¸‹ã®ã‚ˆã†ã«æŒ‡å®šã—ã¾ã™ã€‚

```go
import "github.com/spiegel-im-spiegel/astrocalc/modjulian"
```

ã“ã“ã§ã¯ GitHub ã® [spiegel-im-spiegel/astrocalc](https://github.com/spiegel-im-spiegel/astrocalc) ãƒªãƒã‚¸ãƒˆãƒªã« `modjulian` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç½®ã„ã¦ã¿ã¾ã—ãŸã€‚

ãŸã ã— build ã‚„ run ã‚³ãƒãƒ³ãƒ‰ã§ã¯ãƒªãƒã‚¸ãƒˆãƒªä¸Šã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è‡ªå‹•çš„ã«ã¨ã£ã¦ãã¾ã›ã‚“ã€‚ã¾ãšã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ get ã—ã¾ã™ã€‚ï¼ˆget ã‚³ãƒãƒ³ãƒ‰ã«ã¤ã„ã¦ã¯ã€Œ[ãã®3](http://qiita.com/spiegel-im-spiegel/items/a52a47942fd3946bb583)ã€ã‚’å‚ç…§ï¼‰

```shell
C:>go get -v github.com/spiegel-im-spiegel/astrocalc/modjulian
github.com/spiegel-im-spiegel/astrocalc (download)
github.com/spiegel-im-spiegel/astrocalc/modjulian
```

ã“ã‚Œã§ `%GOPATH%` ä¸Šã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å–ã£ã¦ãã¾ã—ãŸã€‚

å‘¼ã³å‡ºã—å´ã¯ `import` ä»¥å¤–ã¯å…ˆã»ã©ã¨åŒã˜ã§ã™ã€‚

```go:jd4c.go
package main

import (
	"flag"
	"fmt"
	"github.com/spiegel-im-spiegel/astrocalc/modjulian"
	"strconv"
	"time"
)

func main() {
	//å¼•æ•°ã®ãƒã‚§ãƒƒã‚¯
	flag.Parse()
	argsStr := flag.Args()
	if len(argsStr) < 3 {
		fmt.Printf("å¹´æœˆæ—¥ã‚’æŒ‡å®šã—ã¦ãã ã•ã„")
		return
	}
	args := make([]int, 3)
	for i := 0; i < 3; i++ {
		num, err := strconv.Atoi(argsStr[i])
		if err != nil {
			if enum, ok := err.(*strconv.NumError); ok {
				switch enum.Err {
				case strconv.ErrRange:
					fmt.Printf("Bad Range Error")
				case strconv.ErrSyntax:
					fmt.Printf("Syntax Error")
				}
			}
			return
		} else {
			args[i] = num
		}
	}
	tm := time.Date(args[0], time.Month(args[1]), args[2], 0, 0, 0, 0, time.UTC)
	fmt.Printf("%v\n", tm)
	fmt.Printf("MJD = %dæ—¥\n", modjulian.DayNumber(tm))
}
```

```shell
C:>go run jd4c.go 1969 12 31
1969-12-31 00:00:00 +0000 UTC
MJD = 40586æ—¥

C:>go run jd4c.go 1970 1 1
1970-01-01 00:00:00 +0000 UTC
MJD = 40587æ—¥

C:>go run jd4c.go 2015 1 1
2015-01-01 00:00:00 +0000 UTC
MJD = 57023æ—¥
```

åŒã˜çµæœãŒå¾—ã‚‰ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚

## ã•ã¦...

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã¤ã„ã¦ã‚‚ã†å°‘ã—æ˜ã‚Šä¸‹ã’ã‚‹ã¹ãã‹ã€‚ãã‚Œã¨ã‚‚æš¦è¨ˆç®—ã«æˆ»ã‚‹ã‹ã€‚

## è„šæ³¨

