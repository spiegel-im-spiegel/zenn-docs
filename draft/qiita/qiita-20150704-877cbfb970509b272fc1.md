---
title: "MSYS2 ã«ã‚ˆã‚‹ gcc é–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰ï¼ˆ2ï¼‰"
emoji: "ğŸ˜€"
type: "tech"
topics: [GCC,msys2]
published: false
---
[å‰å›](http://qiita.com/spiegel-im-spiegel/items/ba4e8d2418bdfe0c8049)ã¯ [MSYS2] ã§ [MinGW-w64] ã®ç’°å¢ƒã‚’å…¥ã‚Œã‚‹ã¨ã“ã‚ã§çµ‚ã‚ã£ã¦ã—ã¾ã„ï¼Œï¼ˆãã®å¾Œä»•äº‹ãŒå¿™ã—ããªã£ãŸã“ã¨ã‚‚ã‚ã‚Šï¼‰ãã®ã¾ã¾æŠ•ã’ã£ã±ãªã—ã®çŠ¶æ…‹ã ã£ãŸãŒï¼Œã¨ã‚Šã‚ãˆãš gcc ã®å‹•ä½œç¢ºèªã¾ã§çµ‚ã‚ã‚‰ã›ã¦ãŠãã€‚ãã†ãã†ï¼Œ `pacman -Syu` ã§æœ€æ–°ç‰ˆã«æ›´æ–°ã™ã‚‹ã®ã‚’å¿˜ã‚Œãªã„ã‚ˆã†ã«ã€‚

ä»Šå›ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¯ [pgpdump]ã€‚

[pgpdump] ã¯ OpenPGP ãƒ‘ã‚±ãƒƒãƒˆã‚’å¯è¦–åŒ–ã—ã¦ãã‚Œã‚‹ï¼ˆãŸã ã—å¾©å·ã¯è¡Œã‚ãªã„ï¼‰ä¾¿åˆ©ãƒ„ãƒ¼ãƒ«ã ã€‚ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ã¿ã®æä¾›ã§ãƒã‚¤ãƒŠãƒªã¯æä¾›ã•ã‚Œã¦ãªã„ï¼ˆãŸã ã— Linux ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ã«ã‚ˆã£ã¦ã¯ãƒã‚¤ãƒŠãƒªã‚’æä¾›ã—ã¦ã„ã‚‹å ´åˆãŒã‚ã‚‹ï¼‰ã€‚ãƒ“ãƒ«ãƒ‰ã™ã‚Œã° Windows ç’°å¢ƒã§ã‚‚å‹•ä½œå¯èƒ½ã€‚

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ GitHub ã§æä¾›ã•ã‚Œã¦ã„ã‚‹ã®ã§ï¼Œã‚ã‚‰ã‹ã˜ã‚ `git clone` ã§å–å¾—ã—ã¦ãŠãã€‚

- [kazu-yamamoto/pgpdump](https://github.com/kazu-yamamoto/pgpdump)

## Win32 ç‰ˆã®ãƒ“ãƒ«ãƒ‰

ã¾ãšã¯ `mingw32_shell.bat` ã‚’èµ·å‹•ã—ã¦ Win32 ã®ç’°å¢ƒã‚’ç«‹ã¡ä¸Šã’ã‚‹ï¼ˆ`mingw32_shell.bat` ã£ã¦ä½•ï¼Ÿ ã£ã¦ã‹ãŸã¯[å‰å›ã®è¨˜äº‹](http://qiita.com/spiegel-im-spiegel/items/ba4e8d2418bdfe0c8049)ã‚’å‚ç…§ã‚ã‚Œï¼‰ã€‚

ã¾ãšã¯ `configure` ã‚’èµ°ã‚‰ã›ã¦ç’°å¢ƒã‚’ç¢ºèªã™ã‚‹ã€‚

```shell
$ ./configure
checking for gcc... gcc
checking whether the C compiler works... yes
checking for C compiler default output file name... a.exe
checking for suffix of executables... .exe
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ISO C89... none needed
checking for inflate in -lz... yes
checking for BZ2_bzBuffToBuffDecompress in -lbz2... yes
checking how to run the C preprocessor... gcc -E
checking for grep that handles long lines and -e... /usr/bin/grep
checking for egrep... /usr/bin/grep -E
checking for ANSI C header files... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking for unistd.h... (cached) yes
checking sys/time.h usability... yes
checking sys/time.h presence... yes
checking for sys/time.h... yes
checking unixlib/local.h usability... no
checking unixlib/local.h presence... no
checking for unixlib/local.h... no
checking whether time.h and sys/time.h may both be included... yes
checking whether struct tm is in sys/time.h or time.h... time.h
checking for struct tm.tm_zone... no
checking whether tzname is declared... yes
checking for tzname... yes
configure: creating ./config.status
config.status: creating Makefile
config.status: WARNING:  'Makefile.in' seems to ignore the --datarootdir setting
config.status: creating config.h
```

ç‰¹ã«ã‚¨ãƒ©ãƒ¼ã‚‚ãªãçµ‚äº†ã€‚

[pgpdump] ã§ã¯ï¼Œãƒ‘ã‚±ãƒƒãƒˆå†…ã®åœ§ç¸®ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ãŸã‚ï¼Œ `libz` ãŠã‚ˆã³ `libbz2` ãŒå¿…è¦ã¨ãªã‚‹ã€‚æ˜”ã® MinGW32 ã§ã¯ã“ã‚Œã‚‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å€‹åˆ¥ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸãŒï¼Œæœ€è¿‘ã®ã¯ã‚ã‚‰ã‹ã˜ã‚é–‹ç™ºç’°å¢ƒã«å…¥ã£ã¦ã‚‹ã®ã§åŠ©ã‹ã‚‹ã€‚

ã“ã‚Œã§ç”Ÿæˆã•ã‚Œã‚‹ `Makefile` ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã€‚

```makefile:Makefile
prefix = /usr/local
exec_prefix = ${prefix}
bindir = ${exec_prefix}/bin
mandir = ${prefix}/share/man
LIBS = -lbz2 -lz
CFLAGS  = -g -O2 -O -Wall
LDFLAGS =
VERSION = `git tag | tail -1 | sed -e 's/v//'`

RM = rm -f
INSTALL  = install

INCS = pgpdump.h
SRCS = pgpdump.c types.c tagfuncs.c packet.c subfunc.c signature.c keys.c \
       buffer.c uatfunc.c
OBJS = pgpdump.o types.o tagfuncs.o packet.o subfunc.o signature.o keys.o \
       buffer.o uatfunc.o
PROG = pgpdump

MAN  = pgpdump.1

CNF = config.h config.status config.cache config.log
MKF = Makefile

.c.o:
	$(CC) -c $(CFLAGS) $<

all: $(PROG)

$(PROG): $(OBJS)
	$(CC) $(CFLAGS) -o $(PROG) $(OBJS) $(LIBS) $(LDFLAGS)

clean:
	$(RM) $(OBJS) $(PROG)

distclean:
	$(RM) $(OBJS) $(PROG) $(CNF) $(MKF)

install: all
	$(INSTALL) -d $(DESTDIR)$(bindir)
	$(INSTALL) -cp -pm755 $(PROG) $(DESTDIR)$(bindir)
	$(INSTALL) -d $(DESTDIR)$(mandir)/man1
	$(INSTALL) -cp -pm644 $(MAN) $(DESTDIR)$(mandir)/man1

archive:
	git archive master -o ~/pgpdump-$(VERSION).tar --prefix=pgpdump-$(VERSION)/
	gzip ~/pgpdump-$(VERSION).tar
```

ã“ã®æ™‚ç‚¹ã§ã®å•é¡Œã¯3ã¤ã€‚

1. `prefix` ãŒ `/usr/local` ã«ãªã£ã¦ã„ã‚‹ã€‚ã“ã®ã¾ã¾ã§ã‚‚ã‚¨ãƒ©ãƒ¼ã«ã¯ãªã‚‰ãªã„ãŒï¼Œä»Šå›ã¯ Win32 ç‰ˆã¨ Win64 ç‰ˆã‚’åˆ†ã‘ãŸã„ã®ã§ `/mingw32` ã¨ã—ãŸã„
1. `CC` ãŒæ˜ç¤ºã•ã‚Œãªã„ã®ã§ã“ã®ã¾ã¾ `mingw32-make` ã‚’èµ°ã‚‰ã›ã‚‹ã¨ `cc` ã‚³ãƒãƒ³ãƒ‰ã‚’å‘¼ã³ã ãã†ã¨ã™ã‚‹
1. ãƒªãƒ³ã‚¯æ™‚ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆ`LDFLAGS`ï¼‰ã« `-static` ãŒãªã„ãŸã‚ï¼Œã“ã®ã¾ã¾ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ DLL ã«ä¾å­˜ã™ã‚‹æ§‹æˆã«ãªã£ã¦ã—ã¾ã†

ã“ã®ã†ã¡2ç•ªç›®ã®å•é¡Œã¯å°‘ã—å„ä»‹ã ãŒ

1. Malefile.in ã« `CC = @CC@` ã®è¨˜è¿°ã‚’è¿½åŠ ã—ã¦ `configure` ã—ãªãŠã™
1. `mingw32-make` èµ·å‹•æ™‚ã®å¼•æ•°ã« `CC=gcc` ã‚’è¿½åŠ ã™ã‚‹
1. ç’°å¢ƒå¤‰æ•°ã« `CC=gcc` ã‚’è¿½åŠ ã™ã‚‹

ã®ã„ãšã‚Œã‹ã§å¯¾å‡¦ã§ãã‚‹ã€‚

1ç•ªç›®ã¨3ç•ªç›®ã¯ `configure` ã‚³ãƒãƒ³ãƒ‰ã«æƒ…å ±ã‚’æ¸¡ã›ã°ã‚ˆã„ã€‚

```shell
$ ./configure --prefix=/mingw32 LDFLAGS=-static
```

ã§ã¯ï¼Œä½œã‚ŠãªãŠã—ãŸ `Makefile` ã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã€‚

```shell
$ mingw32-make
gcc -c -g -O2 -O -Wall pgpdump.c
gcc -c -g -O2 -O -Wall types.c
gcc -c -g -O2 -O -Wall tagfuncs.c
gcc -c -g -O2 -O -Wall packet.c
gcc -c -g -O2 -O -Wall subfunc.c
gcc -c -g -O2 -O -Wall signature.c
gcc -c -g -O2 -O -Wall keys.c
gcc -c -g -O2 -O -Wall buffer.c
gcc -c -g -O2 -O -Wall uatfunc.c
gcc -g -O2 -O -Wall -o pgpdump pgpdump.o types.o tagfuncs.o packet.o subfunc.o signature.o keys.o buffer.o uatfunc.o -lbz2 -lz  -static

$ strip pgpdump.exe
```

## Win64 ç‰ˆã®ãƒ“ãƒ«ãƒ‰

æ¬¡ã¯ Win64 ç‰ˆã€‚ `mingw64_shell.bat` ã‚’èµ·å‹•ã—ã¦ Win64 ã®ç’°å¢ƒã‚’ç«‹ã¡ä¸Šã’ã‚‹ã€‚ Win32 ç‰ˆã§è¦é ˜ã¯åˆ†ã‹ã£ãŸã®ã§ä¸€æ°—ã«çµ‚ã‚ã‚‰ã›ã¦ã—ã¾ãŠã†ã€‚

```shell
$ ./configure --prefix=/mingw64 LDFLAGS=-static
checking for gcc... gcc
checking whether the C compiler works... yes
checking for C compiler default output file name... a.exe
checking for suffix of executables... .exe
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ISO C89... none needed
checking for inflate in -lz... yes
checking for BZ2_bzBuffToBuffDecompress in -lbz2... yes
checking how to run the C preprocessor... gcc -E
checking for grep that handles long lines and -e... /usr/bin/grep
checking for egrep... /usr/bin/grep -E
checking for ANSI C header files... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking for unistd.h... (cached) yes
checking sys/time.h usability... yes
checking sys/time.h presence... yes
checking for sys/time.h... yes
checking unixlib/local.h usability... no
checking unixlib/local.h presence... no
checking for unixlib/local.h... no
checking whether time.h and sys/time.h may both be included... yes
checking whether struct tm is in sys/time.h or time.h... time.h
checking for struct tm.tm_zone... no
checking whether tzname is declared... yes
checking for tzname... yes
configure: creating ./config.status
config.status: creating Makefile
config.status: WARNING:  'Makefile.in' seems to ignore the --datarootdir setting
config.status: creating config.h

$ mingw32-make.exe
gcc -c -g -O2 -O -Wall pgpdump.c
gcc -c -g -O2 -O -Wall types.c
gcc -c -g -O2 -O -Wall tagfuncs.c
gcc -c -g -O2 -O -Wall packet.c
gcc -c -g -O2 -O -Wall subfunc.c
gcc -c -g -O2 -O -Wall signature.c
gcc -c -g -O2 -O -Wall keys.c
gcc -c -g -O2 -O -Wall buffer.c
gcc -c -g -O2 -O -Wall uatfunc.c
gcc -g -O2 -O -Wall -o pgpdump pgpdump.o types.o tagfuncs.o packet.o subfunc.o signature.o keys.o buffer.o uatfunc.o -lbz2 -lz  -static

$ strip pgpdump.exe
```

## å‹•ä½œç¢ºèª

[pgpdump] ã®å‹•ä½œç¢ºèªã®ãŸã‚ã« [JPCERT/CC ã®å…¬é–‹éµ](https://www.jpcert.or.jp/jpcert-pgp.html)ã‚’ãƒ€ãƒ³ãƒ—ã—ã¦ã¿ã‚‹ã€‚ Windows ç’°å¢ƒã§å•é¡Œãªãå‹•ãã“ã¨ã‚’ç¢ºã‹ã‚ã‚‹ãŸã‚ã«ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‹ã‚‰èµ·å‹•ã™ã‚‹ã€‚

```shell
C:>pgpdump info-0x69ECE048.asc
Old: Public Key Packet(tag 6)(269 bytes)
        Ver 4 - new
        Public key creation time - Tue Jun 02 14:43:57 æ±äº¬ (æ¨™æº–æ™‚) 2009
        Pub alg - RSA Encrypt or Sign(pub 1)
        RSA n(2048 bits) - ...
        RSA e(17 bits) - ...
Old: User ID Packet(tag 13)(29 bytes)
        User ID - JPCERT/CC <info@jpcert.or.jp>
Old: Signature Packet(tag 2)(316 bytes)
        Ver 4 - new
        Sig type - Generic certification of a User ID and Public Key packet(0x10).
        Pub alg - RSA Encrypt or Sign(pub 1)
        Hash alg - SHA1(hash 2)
        Hashed Sub: preferred symmetric algorithms(sub 11)(3 bytes)
                Sym alg - AES with 256-bit key(sym 9)
                Sym alg - CAST5(sym 3)
                Sym alg - Triple-DES(sym 2)
        Hashed Sub: key server preferences(sub 23)(4 bytes)
                Flag - No-modify
        Hashed Sub: key flags(sub 27)(4 bytes)
                Flag - This key may be used to certify other keys
                Flag - This key may be used to sign data
                Flag - This key may be used to encrypt communications
                Flag - This key may be used to encrypt storage
                Flag - The private component of this key may be in the possession of more than one person
        Hashed Sub: preferred compression algorithms(sub 22)(2 bytes)
                Comp alg - ZLIB <RFC1950>(comp 2)
                Comp alg - ZIP <RFC1951>(comp 1)
        Hashed Sub: features(sub 30)(4 bytes)
                Flag - Modification detection (packets 18 and 19)
        Hashed Sub: preferred hash algorithms(sub 21)(3 bytes)
                Hash alg - SHA256(hash 8)
                Hash alg - SHA384(hash 9)
                Hash alg - SHA512(hash 10)
        Hashed Sub: signature creation time(sub 2)(4 bytes)
                Time - Tue Jun 16 12:51:22 æ±äº¬ (æ¨™æº–æ™‚) 2009
        Sub: issuer key ID(sub 16)(8 bytes)
                Key ID - 0x317D97A469ECE048
        Hash left 2 bytes - cd 79
        RSA m^d mod n(2047 bits) - ...
                -> PKCS-1
Old: Signature Packet(tag 2)(277 bytes)
        Ver 3 - old
        Hash material(5 bytes):
                Sig type - Generic certification of a User ID and Public Key packet(0x10).
                Creation time - Tue Jun 02 14:43:57 æ±äº¬ (æ¨™æº–æ™‚) 2009
        Key ID - 0xE7734FA60C7BDE12
        Pub alg - RSA Encrypt or Sign(pub 1)
        Hash alg - SHA1(hash 2)
        Hash left 2 bytes - e9 53
        RSA m^d mod n(2047 bits) - ...
                -> PKCS-1
Old: Signature Packet(tag 2)(156 bytes)
        Ver 4 - new
        Sig type - Generic certification of a User ID and Public Key packet(0x10).
        Pub alg - RSA Encrypt or Sign(pub 1)
        Hash alg - SHA1(hash 2)
        Hashed Sub: signature creation time(sub 2)(4 bytes)
                Time - Mon Jun 15 14:51:27 æ±äº¬ (æ¨™æº–æ™‚) 2009
        Sub: issuer key ID(sub 16)(8 bytes)
                Key ID - 0x8C756B2E2C94D4ED
        Hash left 2 bytes - 35 fd
        RSA m^d mod n(1022 bits) - ...
                -> PKCS-1
Old: Public Subkey Packet(tag 14)(269 bytes)
        Ver 4 - new
        Public key creation time - Tue Jun 02 14:43:57 æ±äº¬ (æ¨™æº–æ™‚) 2009
        Pub alg - RSA Encrypt or Sign(pub 1)
        RSA n(2048 bits) - ...
        RSA e(17 bits) - ...
Old: Signature Packet(tag 2)(577 bytes)
        Ver 4 - new
        Sig type - Subkey Binding Signature(0x18).
        Pub alg - RSA Encrypt or Sign(pub 1)
        Hash alg - SHA1(hash 2)
        Hashed Sub: signature creation time(sub 2)(4 bytes)
                Time - Tue Jun 02 14:43:58 æ±äº¬ (æ¨™æº–æ™‚) 2009
        Hashed Sub: key flags(sub 27)(4 bytes)
                Flag - This key may be used to encrypt communications
                Flag - This key may be used to encrypt storage
        Hashed Sub: embedded signature(sub 32)(284 bytes)
        Ver 4 - new
        Sig type - Primary Key Binding Signature(0x19).
        Pub alg - RSA Encrypt or Sign(pub 1)
        Hash alg - SHA256(hash 8)
        Hashed Sub: signature creation time(sub 2)(4 bytes)
                Time - Tue Jun 02 14:43:57 æ±äº¬ (æ¨™æº–æ™‚) 2009
        Sub: issuer key ID(sub 16)(8 bytes)
                Key ID - 0x09D704B753BA1622
        Hash left 2 bytes - 71 2d
        RSA m^d mod n(2048 bits) - ...
                -> PKCS-1
        Sub: issuer key ID(sub 16)(8 bytes)
                Key ID - 0x317D97A469ECE048
        Hash left 2 bytes - 1d e2
        RSA m^d mod n(2046 bits) - ...
                -> PKCS-1
```

ã†ã‚€ï¼Œå•é¡Œãªã„ã‚ˆã†ã ãªã€‚ã¡ãªã¿ã« Windows ãƒã‚¤ãƒŠãƒªã¯[ã†ã¡ã®ã‚µã‚¤ãƒˆã§ã‚‚å…¬é–‹](http://www.baldanders.info/spiegel/archive/pgpdump/)ã—ã¦ã„ã‚‹ã®ã§ã”è‡ªç”±ã«ã©ã†ãã€‚

[MSYS2]: https://github.com/msys2 "msys2"
[MinGW-w64]: http://mingw-w64.org/ "Mingw-w64 - GCC for Windows 64 & 32 bits [mingw-w64]"
[pgpdump]: http://www.mew.org/~kazu/proj/pgpdump/en/ "pgpdump"

