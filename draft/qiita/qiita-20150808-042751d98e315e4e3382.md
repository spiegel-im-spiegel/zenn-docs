---
title: "Git.io çŸ­ç¸® URL ã‚’ golang ã‚³ãƒ¼ãƒ‰ã§å–å¾—ã—ã¦ã¿ã‚‹"
emoji: "ğŸ˜€"
type: "tech"
topics: [Go,GitHub,curl]
published: false
---
## Git.io ã§çŸ­ç¸® URL ãŒå–å¾—ã§ãã‚‹ã‚‰ã—ã„

- [Gitãƒ»Githubã«éš ã•ã‚ŒãŸä¾¿åˆ©ãªæ©Ÿèƒ½ | GitHub Cheat Sheetï¼ˆæ—¥æœ¬èªè¨³ï¼‰ - Qiita](http://qiita.com/sotayamashita/items/1cf05f2a2be3d6fb3388)

ã“ã‚Œã‚’èª­ã‚“ã§ãŸã‚‰å¾Œã‚ã®æ–¹ã« [Git.io] ã®è©±ãŒå‡ºã¦ã„ãŸã€‚ã“ã®ã‚µã‚¤ãƒˆã§çŸ­ç¸® URL ã‚’ç”Ÿæˆã§ãã‚‹ã‚‰ã—ã„ã€‚

- [Git.io: GitHub URL Shortener](https://github.com/blog/985-git-io-github-url-shortener)

API ãŒ [curl] ã§æ²è¼‰ã•ã‚Œã¦ã„ã¦ï¼Œä¾‹ãˆã°ç§ã® [https://github.com/spiegel-im-spiegel](https://github.com/spiegel-im-spiegel) ãªã‚‰

```shell
$ curl -i "http://git.io" -F "url=https://github.com/spiegel-im-spiegel"
HTTP/1.1 201 Created
Server: Cowboy
Connection: keep-alive
Date: Sat, 08 Aug 2015 02:42:16 GMT
Status: 201 Created
Content-Type: text/html;charset=utf-8
Location: http://git.io/vOj52
Content-Length: 37
X-Xss-Protection: 1; mode=block
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
X-Runtime: 0.210952
X-Node: 871d903e-a8e0-46ff-a96f-ef424385e5ed
X-Revision: b1d9ce07ccb700fc90398edafd397beb8d3bd772
Via: 1.1 vegur

https://github.com/spiegel-im-spiegel
```

ã¦ãªæ„Ÿã˜ã§ï¼Œãƒ˜ãƒƒãƒ€ã® Location è¦ç´ ã«çŸ­ç¸® URL ãŒè¿”ã£ã¦ãã‚‹ä»•çµ„ã¿ã‚‰ã—ã„ã€‚

ã£ã¦ï¼Œã“ã‚Œã£ã¦ [curl] ã§æ›¸ã‘ã‚‹ã‚“ãªã‚‰ golang ã§è¡¨ç¾ã§ãã‚‹ã‚“ã˜ã‚ƒã­ï¼Ÿ

## cURL as DSL

- [cURL as DSL â€” cURL as DSL 1.0 documentation](https://shibukawa.github.io/curl_as_dsl/)
- [Shibu's Diary: cURL as DSLã¨ã¯ä½•ã ã£ãŸã®ã‹ã€‚ã‚ã‚‹ã„ã¯ç´°ã‹ã™ãã¦ä¼ã‚ã‚‰ãªã„cURL as DSLã€‚](http://blog.shibu.jp/article/115602749.html)

[cURL as DSL](https://shibukawa.github.io/curl_as_dsl/) ã¨ã¯ [curl] ã®æ§‹æ–‡ã‚’ä»»æ„ã®ã‚³ãƒ¼ãƒ‰ï¼ˆä»Šã®ã¨ã“ã‚ã¯ golang, Python, PHP, JavaScript, Java, Objective-C, Vim Scriptï¼‰ã«å¤‰æ›ã—ã¦ãã‚Œã‚‹ã‚‚ã®ã§ï¼Œã©ã†ã„ã†ã“ã¨ã‹ã¨ã„ã†ã¨ã€Œ[Web API ã¯ curl ã§è¡¨ç¾ã™ã‚Œã°ã„ã„ã‚“ã˜ã‚ƒã­ï¼Ÿ](http://qiita.com/Hiraku/items/dfda2f8a5353b0742271)ã€ã¨ã„ã†ã“ã¨ã‚‰ã—ã„ã€‚

## ã•ã£ãã curl ã‚’ golang ã«å¤‰æ›ã—ã¦ã¿ã‚‹

ã§ã¯æ—©é€Ÿï¼Œä¸Šè¿°ã® curl ã‚³ãƒãƒ³ãƒ‰ã‚’ golang ã«å¤‰æ›ã—ã¦ã¿ã‚‹ï¼ˆã¡ãªã¿ã« `-i` ã¯ä»˜ã‘ãªã„ï¼‰ã€‚ã“ã‚“ãªæ„Ÿã˜ã€‚

```go:gitio0.go
package main

import (
	"bytes"
	"io/ioutil"
	"log"
	"mime/multipart"
	"net/http"
)

func main() {
	var buffer bytes.Buffer
	writer := multipart.NewWriter(&buffer)
	writer.WriteField("url", "https://github.com/spiegel-im-spiegel")

	resp, err := http.Post("http://git.io", "multipart/form-data; boundary="+writer.Boundary(), &buffer)
	if err != nil {
		log.Fatal(err)
	}
	defer resp.Body.Close()
	body, err := ioutil.ReadAll(resp.Body)
	if err != nil {
		log.Fatal(err)
	}
	log.Print(string(body))
}
```

ã¾ãšã¯ä½•ã‚‚è€ƒãˆãšã«å‹•ã‹ã—ã¦ã¿ã‚‹ã€‚

```shell
C:>go run gitio0.go
2015/08/08 12:00:00 Invalid url:
```

ã‚ã‚Œï¼Ÿ ãŠã‹ã—ã„ãªãã€‚ã‚“ï½ï¼Œã˜ã‚ƒã‚ã¡ã‚‡ã£ã¨å‡ºåŠ›ã‚’ã„ã˜ã£ã¦...

```go:gitio1.go
package main

import (
	"bytes"
	"io/ioutil"
	"log"
	"mime/multipart"
	"net/http"
)

func main() {
	var buffer bytes.Buffer
	writer := multipart.NewWriter(&buffer)
	writer.WriteField("url", "https://github.com/spiegel-im-spiegel")

	resp, err := http.Post("http://git.io", "multipart/form-data; boundary="+writer.Boundary(), &buffer)
	if err != nil {
		log.Fatal(err)
	}
	defer resp.Body.Close()
	body, err := ioutil.ReadAll(resp.Body)
	if err != nil {
		log.Fatal(err)
	}
	log.Println("  Status: ", resp.Header.Get("Status"))
	log.Println("Location: ", resp.Header.Get("Location"))
	log.Println("    Body: ", string(body))
}
```

```shell
C:>go run gitio1.go
2015/08/08 12:00:00   Status: 422 Unprocessable Entity
2015/08/08 12:00:00 Location:
2015/08/08 12:00:00     Body: Invalid url:
```

ã‚“ï¼Ÿ ã‚ã£ãã†ã‹ã€‚ url ãŒã¡ã‚ƒã‚“ã¨æ¸¡ã£ã¦ãªã„ã‚“ã ã€‚ã²ã¨ã—ãã‚Šæ‚©ã‚“ã å¾Œï¼Œä»¥ä¸‹ã®ã‚ˆã†ã«ã™ã‚Œã°ã„ã„ã“ã¨ã«æ°—ãŒã¤ã„ãŸã€‚

```go:gitio2.go
package main

import (
	"bytes"
	"io/ioutil"
	"log"
	"mime/multipart"
	"net/http"
)

func main() {
	var buffer bytes.Buffer
	writer := multipart.NewWriter(&buffer)
	writer.WriteField("url", "https://github.com/spiegel-im-spiegel")
	writer.Close() //writer ã¯ã¡ã‚ƒã‚“ã¨é–‰ã˜ã¾ã—ã‚‡ã†

	resp, err := http.Post("http://git.io", "multipart/form-data; boundary="+writer.Boundary(), &buffer)
	if err != nil {
		log.Fatal(err)
	}
	defer resp.Body.Close()
	body, err := ioutil.ReadAll(resp.Body)
	if err != nil {
		log.Fatal(err)
	}
	log.Println("  Status: ", resp.Header.Get("Status"))
	log.Println("Location: ", resp.Header.Get("Location"))
	log.Println("    Body: ", string(body))
}
```

å¤šåˆ† `buffer` ã« flush ã•ã‚Œã¦ãªã‹ã£ãŸã‚“ã ã­ï¼ˆã“ã®å•é¡Œã¯[ä¿®æ­£ã•ã‚ŒãŸ](#comment-8cb38c8ea500d627f725)ã‚ˆã†ã§ã™ï¼‰ã€‚ã“ã‚Œã§

```shell
C:>go run gitio2.go
2015/08/08 12:00:00   Status: 201 Created
2015/08/08 12:00:00 Location: http://git.io/vOj52
2015/08/08 12:00:00     Body: https://github.com/spiegel-im-spiegel
```

ã¨ãªã‚Šï¼Œã‚ã§ãŸãçŸ­ç¸® URL ãŒå–å¾—ã§ããŸã€‚

ã¡ãªã¿ã«ï¼Œã“ã‚Œã«ã¯ `http.PostForm` é–¢æ•°ã‚’ä½¿ã£ãŸåˆ¥è§£ãŒã‚ã‚‹ã€‚æœ€åˆã® [curl] ã®å¼ã® `-F` ã‚’ `-d` ã«ã‹ãˆã‚Œã°ã„ã„ã‚‰ã—ã„ã€‚çµæœã¯ä»¥ä¸‹ã®é€šã‚Š

```go:gitio0b.go
package main

import (
	"io/ioutil"
	"log"
	"net/http"
	"net/url"
)

func main() {
	values := url.Values{
		"url": {"https://github.com/spiegel-im-spiegel"},
	}

	resp, err := http.PostForm("http://git.io", values)
	if err != nil {
		log.Fatal(err)
	}
	defer resp.Body.Close()
	body, err := ioutil.ReadAll(resp.Body)
	if err != nil {
		log.Fatal(err)
	}
	log.Print(string(body))
}
```

ä»Šå›ã«é™ã‚Œã°ï¼Œã“ã¡ã‚‰ã®ã»ã†ãŒã‚³ãƒ¼ãƒ‰ãŒã‚¹ãƒƒã‚­ãƒªã—ã¦åˆ†ã‹ã‚Šã‚„ã™ã„ã€‚

ã§ã¯ï¼Œæ¥½ã—ã„å¤ä¼‘ã¿ã‚’ï¼

[Git.io]: http://git.io/ "git.io"
[curl]: http://curl.haxx.se/ "curl and libcurl"

