---
title: "tcnksm/gcli ã‚’ä½¿ã£ãŸ golang ã«ã‚ˆã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ»ãƒ„ãƒ¼ãƒ«é–‹ç™ºã«ã¤ã„ã¦"
emoji: "ğŸ˜€"
type: "tech"
topics: [Go,cli]
published: false
---
ä»Šå›ã¯ã€Œ[ã¯ã˜ã‚ã¦ã® Go è¨€èª (on Windows) ãã®10](http://qiita.com/spiegel-im-spiegel/items/5d2878596360af8dd753)ã€ã®ä½™éŒ²ã€‚

ã€Œ[ã¯ã˜ã‚ã¦ã® Go è¨€èª (on Windows) ãã®10](http://qiita.com/spiegel-im-spiegel/items/5d2878596360af8dd753)ã€ã§ [tcnksm/gcli] ã‚’ç´¹ä»‹ã—ãŸã‘ã©ï¼Œã“ã®  [tcnksm/gcli] ã‚’ä½¿ã£ã¦ cli ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ„Ÿæƒ³ï¼ˆè©•ä¾¡ã¾ã§ã¯è¡Œã‹ãªã„ï¼‰ã‚’æ›¸ã„ã¦ã¿ã‚ˆã†ã¨æ€ã†ã€‚ãªã®ã§ [tcnksm/gcli] ãŒã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„ cli ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ä»Šå›ã¯å¯¾è±¡å¤–ã€‚

[tcnksm/gcli] ãŒã‚µãƒãƒ¼ãƒˆã™ã‚‹ cli ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã€‚

- [flag]
- [codegangsta/cli]
- [mitchellh/cli]
- [Like Go command] pattern

[flag] ã¯æ¨™æº–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã‚ã‚‹ã€‚ã€Œ[Like Go command] patternã€ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã¯ãªã„ã®ã ãŒï¼Œ Go ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ä¼¼ãŸã‚³ãƒ¼ãƒ‰ã‚’å‡ºåŠ›ã—ã¦ãã‚Œã‚‹ã€‚

ä¸€è¨€æ„Ÿæƒ³ã¨ã—ã¦ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚

<dl>
<dt>flag</dt>           <dd>ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ãŒãªã„å ´åˆã«ã¯ãŠå‹§ã‚</dd>
<dt>codegangsta/cli</dt><dd>å•é¡Œå¤–</dd>
<dt>mitchellh/cli</dt>  <dd>ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰å½¢å¼ãªã‚‰ãŠå‹§ã‚ã ãŒï¼Œãƒ•ãƒ©ã‚°ã‚’æ‰±ãˆãªã„</dd>
<dt>Like Go command</dt><dd>è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã‹ãªã‚Šã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹å ´åˆã«ã¯ãŠå‹§ã‚</dd>
</dl>

ã‚ãã¾ã§å€‹äººã®æ„Ÿæƒ³ãªã®ã§ï¼Œæ€’ã‚‰ãªã„ã§ã­ã€‚ã§ã¯ï¼Œã‚‚ã†å°‘ã—è©³ã—ãè¦‹ã¦ã„ãã€‚

## ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ»ãƒ„ãƒ¼ãƒ«ã®è¦ä»¶

ã€Œ[ã¯ã˜ã‚ã¦ã® Go è¨€èª (on Windows) ãã®10](http://qiita.com/spiegel-im-spiegel/items/5d2878596360af8dd753)ã€ã§ã‚‚æ›¸ã„ãŸãŒï¼Œä¸€èˆ¬çš„ãªã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ»ãƒ„ãƒ¼ãƒ«ã®è¦ä»¶ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã€‚

- shellï¼ˆbash ã‚„ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãªã©ï¼‰ã‹ã‚‰ã®èµ·å‹•ã‚’å‰æã¨ã™ã‚‹
- ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã®å¼•æ•°ã¾ãŸã¯æ¨™æº–å…¥åŠ›ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚„æ¡ä»¶ã‚’å…¥åŠ›ã™ã‚‹
- çµæœã‚’æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã™ã‚‹
- çµæœä»¥å¤–ã®æƒ…å ±ã¯æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã«å‡ºåŠ›ã™ã‚‹
- shell ã¸å®Ÿè¡Œçµæœã®çŠ¶æ…‹ã‚’è¿”ã™

å®Ÿã¯ã“ã‚Œã«ã‚‚ã†ã²ã¨ã¤é‡è¦ãªè¦ä»¶ã¨ã„ã†ã‹æ€æƒ³ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã£ã¦ï¼Œãã‚Œã¯ã€Œã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ»ãƒ„ãƒ¼ãƒ«ã®æ©Ÿèƒ½ã¯ã§ãã‚‹ã ã‘å˜æ©Ÿèƒ½ã«ã™ã‚‹ã€ã¨ã„ã†ã‚‚ã®ã ã€‚ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ»ãƒ„ãƒ¼ãƒ«ã‚’å˜ç‹¬ã§ä½¿ã†ã“ã¨ã¯å°‘ãªãï¼Œå®Ÿéš›ã«ã¯ shell scriptï¼ˆWindows ãªã‚‰ãƒãƒƒãƒã‚¹ã‚¯ãƒªãƒ—ãƒˆç­‰ï¼‰ã‚’ä½¿ã£ã¦è¤‡æ•°ã®ãƒ„ãƒ¼ãƒ«ã‚’çµ„ã¿åˆã‚ã›ã¦ä½¿ã†ã“ã¨ãŒå¤šã„ã€‚

### Domain-Driven ã§è¡Œã“ã†

DDDï¼ˆDomain-Driven Designï¼‰ã¨ã„ã†ã‚‚ã®ãŒã‚ã‚‹ã€‚ã“ã‚Œã¯ Domain Model ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ãŸè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã“ã¨ã§ DRYï¼ˆDon't Repeat Yourselfï¼‰ãªæ§‹é€ ã«ã™ã‚‹ã®ã«é©ã—ã¦ã„ã‚‹ã¨è¨€ã‚ã‚Œã¦ã„ã‚‹ã€‚ DDD ã¯10å¹´ãã‚‰ã„å‰ã‹ã‚‰å°é ­ã—ã¦ããŸãŒï¼Œæ€æƒ³è‡ªä½“ã¯æ–°ã—ã„ã‚‚ã®ã§ã¯ãªãï¼Œã„ã‚ã‚†ã‚‹ã€Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã€è¨­è¨ˆã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã—ã¦é•·ã„æ™‚é–“ï¼ˆã¨ã„ã£ã¦ã‚‚åŠä¸–ç´€ã¯çµŒã£ã¦ã„ãªã„ã¯ãšã ã‘ã©ï¼‰ã‚’ã‹ã‘ã¦é†¸æˆã•ã‚ŒãŸçŸ¥è¦‹ã®é›†ç©ã¨è¨€ãˆã‚‹ï¼ˆãŸã ã— DDD è‡ªä½“ã¯å¿…ãšã—ã‚‚ã€Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã€ã‚’è¦ä»¶ã¨ã—ãªã„ï¼‰ã€‚

ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ¦‚å¿µã¨ã—ã¦ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªãªæ„Ÿã˜ã ã‚ã†ã€‚ï¼ˆã“ã‚Œï¼Œçµæ§‹ã²ã¨ã«ã‚ˆã£ã¦é•ã†ã‚“ã ã‚ˆãªãï¼‰

[![DDD Architecture](http://www.baldanders.info/spiegel/archive/DDD-fig.svg)](http://www.baldanders.info/spiegel/archive/DDD-fig.html)

ã“ã®ä¸­ã® Domain Layer ã«ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒå…¥ã‚‹ã€‚ä¸Šä¸‹ã®éšå±¤æ§‹é€ ã§ã¯ãªãå·¦å³ã®æ§‹é€ ã«ãªã£ã¦ã„ã‚‹ã®ã¯ï¼Œãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã‚’æ„è­˜ã—ã¦ã»ã—ã„ã‹ã‚‰ã€‚ Iuput (trigger) ã¯å·¦ã‹ã‚‰å³ã«æµã‚Œï¼Œ ouutput (response) ã¯å³ã‹ã‚‰å·¦ã«æµã‚Œã‚‹ã€‚

æ™®é€š DDD ã¯å¤§è¦æ¨¡ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã¾ãŸã¯ã‚µãƒ¼ãƒ“ã‚¹ï¼‰ã®è¨­è¨ˆã§é©ç”¨ã™ã‚‹ã‚‚ã®ã ãŒï¼Œã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ»ãƒ„ãƒ¼ãƒ«ã§ã‚‚ DDD ã‚’æ„è­˜ã™ã‚‹ã“ã¨ã¯æ‚ªããªã„ã—è¨“ç·´ã«ã‚‚ãªã‚‹ã€‚ãŸã¨ãˆã°ï¼Œã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ»ãƒ„ãƒ¼ãƒ«ã‚’å‘¼ã³å‡ºã™ shell ã‚„ shell script ãŒ Presentation Layer ã§ cli ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒ Application Layer ã¨ã„ã£ãŸæ„Ÿã˜ã§è€ƒãˆã‚‹ã€‚ cli ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå‘¼ã³å‡ºã™ãƒ­ã‚¸ãƒƒã‚¯ãŒ Domain Layer ã ã¨è€ƒãˆã‚‹ã¨åˆ†ã‹ã‚Šã‚„ã™ã„ã‹ã‚‚çŸ¥ã‚Œãªã„ã€‚ã¾ãŸï¼Œ[å‰å›ä½œã£ãŸãƒ„ãƒ¼ãƒ«](http://qiita.com/spiegel-im-spiegel/items/5d2878596360af8dd753)ã§ã¯ Git.io ãŒ Data Layer ã«ãªã‚‹ã‚ã‘ã ã€‚

## ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã‚’æŒãŸãªã„æ§‹æˆã®å ´åˆ

è©±ãŒé€¸ã‚Œã¦ã—ã¾ã£ãŸã€‚ cli ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è©±ã«æˆ»ã‚ã†ã€‚

ã¾ãšã¯ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã‚’æŒãŸãªã„æ§‹æˆã®å ´åˆã€‚ä¾‹ãˆã°ã“ã‚“ãªæ„Ÿã˜ã€‚

```bash
$ cmd -flag -parm parameter argument
```

æ¡ä»¶ã‚’æŒ‡å®šã™ã‚‹ `-flag` ã‚„ `-parm` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã£ã¦ï¼Œãã®å¾Œã‚ã«å¼•æ•°ãŒç¶šãã€‚ã“ã†ã„ã£ãŸç”¨é€”ãªã‚‰ [flag] ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒæœ€é©ã§ã‚ã‚‹ã€‚ [tcnksm/gcli] ã§å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ã¿ã‚‹ã€‚

```shell
C:>gcli new -F flag -flag=flag:Bool:"Enable Flag" -flag=parm:String:"Option Parameter" cmd
  Created cmd\main.go
  Created cmd\CHANGELOG.md
  Created cmd\README.md
  Created cmd\cli_test.go
  Created cmd\cli.go
  Created cmd\version.go
====> Successfully generated cmd
```

```go:cmd/main.go
package main

import "os"

func main() {
	cli := &CLI{outStream: os.Stdout, errStream: os.Stderr}
	os.Exit(cli.Run(os.Args))
}
```

```go:cmd/cli.go
package main

import (
	"flag"
	"fmt"
	"io"
)

// Exit codes are int values that represent an exit code for a particular error.
const (
	ExitCodeOK    int = 0
	ExitCodeError int = 1 + iota
)

// CLI is the command line object
type CLI struct {
	// outStream and errStream are the stdout and stderr
	// to write message from the CLI.
	outStream, errStream io.Writer
}

// Run invokes the CLI with the given arguments.
func (cli *CLI) Run(args []string) int {
	var (
		flag bool
		parm string
	)

	// Define option flag parse
	flags := flag.NewFlagSet(Name, flag.ContinueOnError)
	flags.SetOutput(cli.errStream)

	flags.BoolVar(&flag, "flag", false, "Enable Flag")
	flags.StringVar(&parm, "parm", "", "Option Parameter")

	flVersion := flags.Bool("version", false, "Print version information and quit.")

	// Parse commandline flag
	if err := flags.Parse(args[1:]); err != nil {
		return ExitCodeError
	}

	// Show version
	if *flVersion {
		fmt.Fprintf(cli.errStream, "%s version %s\n", Name, Version)
		return ExitCodeOK
	}

	_ = flag

	_ = parm

	return ExitCodeOK
}
```

å®Ÿã¯ã“ã®ã¾ã¾ã§ã¯å¤‰æ•°åã® `flag` ã¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã® `flag` ãŒè¢«ã‚‹ã®ã§ï¼Œã¡ã‚‡ã£ã¨ä¿®æ­£ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³åã‚’ãã®ã¾ã¾å¤‰æ•°åã«ã™ã‚‹ã®ã¯ä½•ã‹ã¨æ‹™ã„ã¨æ€ã†ï¼‰ã€‚ã¾ãŸï¼Œã‚ªãƒ—ã‚·ãƒ§ãƒ³ä»¥å¤–ã®å¼•æ•°ã‚’è§£æã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã¯ãªã„ãŒï¼Œã“ã‚Œã¯è‡ªå‰ã§å®Ÿè£…ã™ã‚‹ã€‚

```go:cmd/cli.go
package main

import (
	"flag"
	"fmt"
	"io"
)

// Exit codes are int values that represent an exit code for a particular error.
const (
	ExitCodeOK    int = 0
	ExitCodeError int = 1 + iota
)

// CLI is the command line object
type CLI struct {
	// outStream and errStream are the stdout and stderr
	// to write message from the CLI.
	outStream, errStream io.Writer
}

// Run invokes the CLI with the given arguments.
func (cli *CLI) Run(args []string) int {
	var (
		flagFlag  bool
		parmFlag  string
		arguments []string
	)

	// Define option flag parse
	flags := flag.NewFlagSet(Name, flag.ContinueOnError)
	flags.SetOutput(cli.errStream)

	flags.BoolVar(&flagFlag, "flag", false, "Enable Flag")
	flags.StringVar(&parmFlag, "parm", "", "Option Parameter")

	flVersion := flags.Bool("version", false, "Print version information and quit.")

	// Parse commandline flag
	if err := flags.Parse(args[1:]); err != nil {
		return ExitCodeError
	}

	// Show version
	if *flVersion {
		fmt.Fprintf(cli.errStream, "%s version %s\n", Name, Version)
		return ExitCodeOK
	}

	for 0 < flags.NArg() {
		arguments = append(arguments, flags.Arg(0))
		flags.Parse(flags.Args()[1:])
	}

	fmt.Fprintln(cli.errStream, "flag =", flagFlag)
	fmt.Fprintln(cli.errStream, "parm =", parmFlag)
	fmt.Fprintln(cli.errStream, "arguments =", arguments)

	return ExitCodeOK
}
```

ã“ã‚Œã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦å‹•ã‹ã—ã¦ã¿ã‚‹ã€‚

```shell
C:>go build ./cmd

C:>cmd -version
cmd version 0.1.0

C:>cmd arg1 arg2
flag = false
parm =
arguments = [arg1 arg2]

C:>cmd -flag -parm parm1 arg1 arg2
flag = true
parm = parm1
arguments = [arg1 arg2]
```

ç”Ÿæˆã•ã‚ŒãŸ `CLI` ã‚¯ãƒ©ã‚¹ã§ã¯ï¼Œæ¨™æº–ï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰å‡ºåŠ›ã‚„å¼•æ•°ã‚’å…¥åŠ›ã¨ã—ã¦æƒ…å ±ã‚’æ•´ç†ã—ãŸä¸Šã§æ¬¡ã®å‡¦ç†ï¼ˆãŠãã‚‰ã Domain Layerï¼‰ã«å‡¦ç†ã‚’æ¸¡ã™ã“ã¨ãŒã§ãã‚‹ã€‚ã‹ãªã‚Šç†æƒ³çš„ãªæ§‹æˆã§ã‚ã‚‹ã€‚ãŸã ã—ï¼Œä½•æ•…ã‹æ¨™æº–å…¥åŠ›ã¯å«ã¾ã‚Œã¦ã„ãªã„ãŸã‚ï¼Œæ¨™æº–å…¥åŠ›ã‚‚å¿…è¦ãªå ´åˆã¯ `CLI` ã‚¯ãƒ©ã‚¹ã‚„ `CLI` ã‚¯ãƒ©ã‚¹ã‚’å‘¼ã³å‡ºã™ `main` é–¢æ•°ã‚’æ›¸ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

## ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã‚’æŒã¤æ§‹æˆã®å ´åˆ

ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã‚’æŒã¤æ§‹æˆã¨ã„ã†ã®ã¯ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªå¼•æ•°ã®æ§‹æˆã«ãªã£ã¦ã„ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹ã€‚

```
command [global options] subcommand [subcommand options] [arguments...]
```

[flag] ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã‚’æ§‹æˆã™ã‚‹ã«ã¯ä¸å‘ãï¼ˆã§ããªã„ã“ã¨ã¯ãªã„ãŒé¢å€’ï¼‰ãªã®ã§ï¼Œä»–ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã†ã“ã¨ã«ãªã‚‹ã€‚

### codegangsta/cli ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ

æ¬¡ã®ã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ã‚’è€ƒãˆã‚‹ã€‚

```bash
$ cmd2 sub -flag -parm parameter argument
```

`sub` ãŒã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã€‚ã“ã‚Œã‚’ [codegangsta/cli] ç”¨ã«ç”Ÿæˆã—ã¦ã¿ã‚‹ã€‚

```shell
C:>gcli new -F codegangsta_cli -c sub:"Sub-command" -flag=flag:Bool:"Enable Flag" -flag=parm:String:"Option Parameter" cmd2
  Created cmd2\CHANGELOG.md
  Created cmd2\main.go
  Created cmd2\version.go
  Created cmd2\command\sub.go
  Created cmd2\command\sub_test.go
  Created cmd2\README.md
  Created cmd2\commands.go
====> Successfully generated cmd2
```

```go:cmd2/main.go
package main

import (
	"os"

	"github.com/codegangsta/cli"
)

func main() {

	app := cli.NewApp()
	app.Name = Name
	app.Version = Version
	app.Author = "Spiegel"
	app.Email = ""
	app.Usage = ""

	app.Flags = GlobalFlags
	app.Commands = Commands
	app.CommandNotFound = CommandNotFound

	app.Run(os.Args)
}
```

è¦‹ãŸã‚‰ã‚ã‹ã‚‹ã¨æ€ã†ãŒï¼Œ [`app.Run()`](http://godoc.org/github.com/codegangsta/cli#App.Run) é–¢æ•°ã®è¿”ã‚Šå€¤ã‚’å…¨ãè¦‹ã¦ã„ãªã„ã€‚å®Ÿã¯ `error` å‹ã®å€¤ã‚’è¿”ã™ã®ã ãŒï¼Œã“ã®ã‚¨ãƒ©ãƒ¼æƒ…å ±ã¯ãƒ¡ã‚¤ãƒ³ã®å‡¦ç†çµæœã«å¯¾ã™ã‚‹ã‚‚ã®ã§ã¯ãªã„ã€‚ãªã‚‰ã°ã©ã†ã™ã‚‹ã‹ã¨ã„ã†ã¨ï¼Œã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰å†…ã®å‡¦ç†ã®ä¸­ã§ `os.Exit()` ã™ã‚‹ã¨ã„ã†ï¼Œã‹ãªã‚Šãˆã’ã¤ãªã„ä»•æ§˜ã«ãªã£ã¦ã„ã‚‹ã€‚å€‹äººçš„ã«ã¯ã“ã®ä¸€ç‚¹ã§ [codegangsta/cli] ã¯ **å•é¡Œå¤–** ãªã®ã ãŒï¼Œã‚‚ã†å°‘ã—ã ã‘è§£èª¬ã™ã‚‹ã€‚

```go:cmd2/commands.go
package main

import (
	"fmt"
	"os"

	"github.com/spiegel-im-spiegel/cmd2/command"
	"github.com/codegangsta/cli"
)

var GlobalFlags = []cli.Flag{
	cli.BoolFlag{
		EnvVar: "ENV_FLAG",
		Name:   "flag",

		Usage: "Enable Flag",
	},
	cli.StringFlag{
		EnvVar: "ENV_PARM",
		Name:   "parm",
		Value:  "",
		Usage:  "Option Parameter",
	},
}

var Commands = []cli.Command{
	{
		Name:   "sub",
		Usage:  "Sub-command",
		Action: command.CmdSub,
		Flags:  []cli.Flag{},
	},
}

func CommandNotFound(c *cli.Context, command string) {
	fmt.Fprintf(os.Stderr, "%s: '%s' is not a %s command. See '%s --help'.", c.App.Name, command, c.App.Name, c.App.Name)
	os.Exit(2)
}
```

æ®‹å¿µãªãŒã‚‰ [tcnksm/gcli] ã¯ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„ã€‚ãªã®ã§ï¼Œ `-flag` ã§æŒ‡å®šã—ãŸã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯å…¨ã¦ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦å®šç¾©ã•ã‚Œã‚‹ã€‚ã‚„ã‚Šæ–¹ã¨ã—ã¦ã¯å¿…è¦ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ [tcnksm/gcli] ã«æ›¸ãå‡ºã—ï¼Œ `commands.go` ã®ä¸­ã§ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦æ‰‹å‹•ã§æŒ¯ã‚Šåˆ†ã‘ç›´ã™ã®ãŒã„ã„ã ã‚ã†ã€‚ä»Šå›ãªã‚‰ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚‹ã€‚

```go:cmd2/commands.go
package main

import (
	"fmt"
	"os"

	"github.com/spiegel-im-spiegel/cmd2/command"
	"github.com/codegangsta/cli"
)

var GlobalFlags = []cli.Flag{}

var Commands = []cli.Command{
	{
		Name:   "sub",
		Usage:  "Sub-command",
		Action: command.CmdSub,
		Flags:  []cli.Flag{
			cli.BoolFlag{
				//EnvVar: "ENV_FLAG",
				Name:   "flag",

				Usage: "Enable Flag",
			},
			cli.StringFlag{
				//EnvVar: "ENV_PARM",
				Name:   "parm",
				Value:  "",
				Usage:  "Option Parameter",
			},
		},
	},
}

func CommandNotFound(c *cli.Context, command string) {
	fmt.Fprintf(os.Stderr, "%s: '%s' is not a %s command. See '%s --help'.", c.App.Name, command, c.App.Name, c.App.Name)
	os.Exit(2)
}
```

ã¨ã“ã‚ã§ `cli.Commans` ãŠã‚ˆã³ `cli.Context` ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã€‚

```go:cli/command.go
type Command struct {
	// The name of the command
	Name string
	// short name of the command. Typically one character (deprecated, use `Aliases`)
	ShortName string
	// A list of aliases for the command
	Aliases []string
	// A short description of the usage of this command
	Usage string
	// A longer explanation of how the command works
	Description string
	// The function to call when checking for bash command completions
	BashComplete func(context *Context)
	// An action to execute before any sub-subcommands are run, but after the context is ready
	// If a non-nil error is returned, no sub-subcommands are run
	Before func(context *Context) error
	// An action to execute after any subcommands are run, but after the subcommand has finished
	// It is run even if Action() panics
	After func(context *Context) error
	// The function to call when this command is invoked
	Action func(context *Context)
	// List of child commands
	Subcommands []Command
	// List of flags to parse
	Flags []Flag
	// Treat all flags as normal arguments if true
	SkipFlagParsing bool
	// Boolean to hide built-in help command
	HideHelp bool

	commandNamePath []string
}
```

```go:cli/context.go
type Context struct {
	App            *App
	Command        Command
	flagSet        *flag.FlagSet
	setFlags       map[string]bool
	globalSetFlags map[string]bool
	parentContext  *Context
}
```

ã¤ã¾ã‚Šã“ã‚ŒãŒ context ã®å…¨ã¦ã§ï¼Œãã®ä¸­ã«ã¯æ¨™æº–å…¥å‡ºåŠ›ã‚„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä»¥å¤–ã®å¼•æ•°æƒ…å ±ã¯å…¥ã£ã¦ã„ãªã„ã€‚ã˜ã‚ƒã‚ï¼Œã©ã†ã™ã‚‹ã‹ã¨ã„ã†ã¨ `Action` property ã«ã‚»ãƒƒãƒˆã™ã‚‹é–¢æ•°å†…ã§æ¨™æº–å…¥å‡ºåŠ›ã‚„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä»¥å¤–ã®å¼•æ•°æƒ…å ±ã‚’å–å¾—ã—ã¦å‡¦ç†ã™ã‚‹ã—ã‹ãªã„ã€‚ãã—ã¦ `Action` property ã«ã‚»ãƒƒãƒˆã™ã‚‹é–¢æ•°ã¯å€¤ã‚’è¿”ã•ãªã„ï¼ˆè¿”ã›ãªã„ï¼‰ã€‚ã—ãŸãŒã£ã¦å‘¼ã³å‡ºã•ã‚Œã‚‹é–¢æ•°ã®å†…éƒ¨ã§ `os.Exit()` ã™ã‚‹ã—ã‹ãªã„ã‚ã‘ã ã€‚ã‚„ã‚Œã‚„ã‚Œã€‚

### mitchellh/cli ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ

åŒã˜ UI ã‚’ï¼Œä»Šåº¦ã¯ [mitchellh/cli] ã‚’ä½¿ã£ã¦å®Ÿè£…ã—ã¦ã¿ã‚‹ã€‚

```shell
C:>gcli new -F mitchellh_cli -c sub:"Sub-command" -flag=flag:Bool:"Enable Flag" -flag=parm:String:"Option Parameter" cmd3
  Created cmd3\main.go
  Created cmd3\command\meta.go
  Created cmd3\command\version.go
  Created cmd3\cli.go
  Created cmd3\CHANGELOG.md
  Created cmd3\version.go
  Created cmd3\commands.go
  Created cmd3\command\sub.go
  Created cmd3\README.md
  Created cmd3\command\sub_test.go
====> Successfully generated cmd3
```

```go:cmd3/cli.go
package main

import (
	"fmt"
	"os"

	"github.com/mitchellh/cli"
	"github.com/spiegel-im-spiegel/cmd3/command"
)

func Run(args []string) int {

	// Meta-option for executables.
	// It defines output color and its stdout/stderr stream.
	meta := &command.Meta{
		Ui: &cli.ColoredUi{
			InfoColor:  cli.UiColorBlue,
			ErrorColor: cli.UiColorRed,
			Ui: &cli.BasicUi{
				Writer:      os.Stdout,
				ErrorWriter: os.Stderr,
				Reader:      os.Stdin,
			},
		}}

	return RunCustom(args, Commands(meta))
}

func RunCustom(args []string, commands map[string]cli.CommandFactory) int {

	// Get the command line args. We shortcut "--version" and "-v" to
	// just show the version.
	for _, arg := range args {
		if arg == "-v" || arg == "-version" || arg == "--version" {
			newArgs := make([]string, len(args)+1)
			newArgs[0] = "version"
			copy(newArgs[1:], args)
			args = newArgs
			break
		}
	}

	cli := &cli.CLI{
		Args:       args,
		Commands:   commands,
		Version:    Version,
		HelpFunc:   cli.BasicHelpFunc(Name),
		HelpWriter: os.Stdout,
	}

	exitCode, err := cli.Run()
	if err != nil {
		fmt.Fprintf(os.Stderr, "Failed to execute: %s\n", err.Error())
	}

	return exitCode
}
```

```go:cmd3/commands.go
package main

import (
	"github.com/mitchellh/cli"
	"github.com/spiegel-im-spiegel/cmd3/command"
)

func Commands(meta *command.Meta) map[string]cli.CommandFactory {
	return map[string]cli.CommandFactory{
		"sub": func() (cli.Command, error) {
			return &command.SubCommand{
				Meta: *meta,
			}, nil
		},

		"version": func() (cli.Command, error) {
			return &command.VersionCommand{
				Meta:     *meta,
				Version:  Version,
				Revision: GitCommit,
				Name:     Name,
			}, nil
		},
	}
}
```


å®Ÿã¯ï¼Œ [mitchellh/cli] è‡ªèº«ã¯ãƒ•ãƒ©ã‚°ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„ã€‚ãã“ã§ [tcnksm/gcli] ãŒ [mitchellh/cli] ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã§ [mitchellh/cli] ã®å¼±ç‚¹ã‚’ã‚«ãƒãƒ¼ã—ã¦ã„ã‚‹ã€‚

æœ€çµ‚çš„ã« [mitchellh/cli] ã«æ¸¡ã™ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ä»¥ä¸‹ã®ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æº€ãŸã—ã¦ã„ã‚Œã°ã‚ˆã„ã€‚

```go:cli/command.go
package cli

// A command is a runnable sub-command of a CLI.
type Command interface {
	// Help should return long-form help text that includes the command-line
	// usage, a brief few sentences explaining the function of the command,
	// and the complete list of flags the command accepts.
	Help() string

	// Run should run the actual command with the given CLI instance and
	// command-line arguments. It should return the exit status when it is
	// finished.
	Run(args []string) int

	// Synopsis should return a one-line, short synopsis of the command.
	// This should be less than 50 characters ideally.
	Synopsis() string
}

// CommandFactory is a type of function that is a factory for commands.
// We need a factory because we may need to setup some state on the
// struct that implements the command itself.
type CommandFactory func() (Command, error)

```

ä¾‹ãˆã° `sub` ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ `command.SubCommand` ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚

```go:cmd3/command/sub.go
package command

import (
	"strings"
)

type SubCommand struct {
	Meta
}

func (c *SubCommand) Run(args []string) int {
	// Write your code here
	return 0
}

func (c *SubCommand) Synopsis() string {
	return "Sub-command"
}

func (c *SubCommand) Help() string {
	helpText := `

`
	return strings.TrimSpace(helpText)
}
```

ã“ã®ã†ã¡ `Run()` é–¢æ•°ãŒå‡¦ç†ã®æœ¬ä½“ã§ã‚ã‚‹ã€‚ [tcnksm/gcli] ã§ã¯ç©ºã£ã½ã®é–¢æ•°ã—ã‹ç”Ÿæˆã—ã¦ãã‚Œãªã„ãŒï¼Œå®Ÿéš›ã«ã¯ã“ã®ä¸­ã§å¼•æ•°ã®è§£æã‚’è¡Œã†ã€‚å¼•æ•°è§£æã«ã¯ [flag] ãŒä½¿ãˆã‚‹ã€‚

```go:cmd3/command/sub.go
func (c *SubCommand) Run(args []string) int {
    var (
		flagFlag  bool
		parmFlag  string
		arguments []string
	)

	// Define option flag parse
	flags := flag.NewFlagSet(Name, flag.ContinueOnError)
    flags.Usage = func() {}

	flags.BoolVar(&flagFlag, "flag", false, "Enable Flag")
	flags.StringVar(&parmFlag, "parm", "", "Option Parameter")

	// Parse commandline flag
	if err := flags.Parse(args[1:]); err != nil {
		return 1
	}
	for 0 < flags.NArg() {
		arguments = append(arguments, flags.Arg(0))
		flags.Parse(flags.Args()[1:])
	}

	c.Ui.Output("flag =", flagFlag)
	c.Ui.Output("parm =", parmFlag)
	c.Ui.Output("arguments =", arguments)

	return 0
}
```

DDD çš„ã«ã¿ã‚Œã°ï¼Œç”Ÿæˆã•ã‚ŒãŸ `command` ã‚µãƒ–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ Application Layer ã® Facade ã¨è¦‹ãªã›ã‚‹ã€‚ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã‚’å‘¼ã³å‡ºã™å´ï¼ˆApplication Layerï¼‰ã¯ `command` ã‚µãƒ–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å„ã‚³ãƒãƒ³ãƒ‰ã‚’å®šå‹çš„ã«å‘¼ã³å‡ºã™ã ã‘ã§ã‚ˆãï¼Œã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã‚’å‘¼ã³å‡ºã•ã‚Œã‚‹å´ï¼ˆDomain Layerï¼‰ã¯ `command` ã‚µãƒ–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã®é–“ã§è©±ãŒé€šã˜ã¦ã„ã‚Œã°ã€Œå‹é”ã®å‹é”ã€ã®ã“ã¨ã¯æ°—ã«ã—ãªãã¦ã‚‚ã‚ˆã„ã€‚

#### æ¨™æº–å…¥å‡ºåŠ›ã«ã¤ã„ã¦

ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ `command.SubCommand` ã«åŸ‹ã‚è¾¼ï¼ˆembedï¼‰ã¾ã‚Œã¦ã„ã‚‹ Meta ã¯ä»¥ä¸‹ã®æ§‹é€ ã«ãªã£ã¦ã„ã‚‹ã€‚

```go:cmd3/command/meta.go
package command

import "github.com/mitchellh/cli"

// Meta contain the meta-option that nearly all subcommand inherited.
type Meta struct {
	Ui cli.Ui
}
```

æ›´ã« `cli.Ui` ã¯ interface å‹ã§

```go:cli/ui.go
// Ui is an interface for interacting with the terminal, or "interface"
// of a CLI. This abstraction doesn't have to be used, but helps provide
// a simple, layerable way to manage user interactions.
type Ui interface {
	// Ask asks the user for input using the given query. The response is
	// returned as the given string, or an error.
	Ask(string) (string, error)

	// AskSecret asks the user for input using the given query, but does not echo
	// the keystrokes to the terminal.
	AskSecret(string) (string, error)

	// Output is called for normal standard output.
	Output(string)

	// Info is called for information related to the previous output.
	// In general this may be the exact same as Output, but this gives
	// Ui implementors some flexibility with output formats.
	Info(string)

	// Error is used for any error messages that might appear on standard
	// error.
	Error(string)

	// Warn is used for any warning messages that might appear on standard
	// error.
	Warn(string)
}
```

ã¨å®šç¾©ã•ã‚Œã¦ã„ã¦ï¼Œç”Ÿã®æ¨™æº–å…¥å‡ºåŠ›ã‚’éš ãºã„ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚ã—ã‹ã—ï¼Œå®Ÿéš›ã«ã¯æ¨™æº–å…¥å‡ºåŠ›ã‚’ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¨ã—ã¦ç›´æ¥åˆ¶å¾¡ã—ãŸã„å ´åˆãŒã‚ã‚‹ã€‚ã¾ãŸï¼Œã‚ªãƒ—ã‚·ãƒ§ãƒ³ç­‰ã§æ¨™æº–å…¥å‡ºåŠ›ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»˜ã‘æ›¿ãˆãŸã„å ´åˆã‚‚ã‚ã‚‹ã®ã§ï¼Œæ¨™æº–å…¥å‡ºåŠ›ã‚’éš ãºã„ã™ã‚‹ã®ã¯å¿…ãšã—ã‚‚å¾—ç­–ã§ã¯ãªã„ã€‚ã“ã®å ´åˆã¯ã„ã£ã

```go:cmd3/command/meta.go
package command

import "github.com/mitchellh/cli"

// Meta contain the meta-option that nearly all subcommand inherited.
type Meta struct {
	Ui cli.BasicUi
}
```

ãªã©ã¨æ›¸ãæ›ãˆãŸã»ã†ãŒã„ã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚ã“ã®è¾ºã¯ãŠå¥½ã¿ã§ã€‚

### Like Go command

æœ€å¾Œã« â€œ[Like Go command]â€ ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ã¿ã‚‹ã€‚

```shell
C:>gcli new -F go_cmd -c sub:"Sub-command" -flag=flag:Bool:"Enable Flag" -flag=parm:String:"Option Parameter" cmd4
  Created cmd4\CHANGELOG.md
  Created cmd4\README.md
  Created cmd4\sub.go
  Created cmd4\sub_test.go
  Created cmd4\main.go
====> Successfully generated cmd4
```

ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯ `Command` ã‚’ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰æ¯ã® context ã¨ã—ã¦å®šç¾©ã—ã¦ã„ã‚‹ã€‚

```go:cmd4/main.go
// A Command is an implementation of a cmd4 command
type Command struct {
	// Run runs the command.
	// The args are the arguments after the command name.
	Run func(args []string) int

	// UsageLine is the one-line usage message.
	// The first word in the line is taken to be the command name.
	UsageLine string

	// Short is the short description shown in the 'cmd4 help' output.
	Short string

	// Long is the long message shown in the 'cmd4 help <this-command>' output.
	Long string

	// Flag is a set of flags specific to this command.
	Flag flag.FlagSet
}

// Commands lists the available commands and help topics.
// The order here is the order in which they are printed by 'cmd4 help'.
var commands = []*Command{
	cmdSub,
}
```

```go:cmd4/sub.go
package main

var cmdSub = &Command{
	Run:       runSub,
	UsageLine: "sub ",
	Short:     "Sub-command",
	Long: `

	`,
}

func init() {
	// Set your flag here like below.
	// cmdSub.Flag.BoolVar(&flagA, "a", false, "")
}

// runSub executes sub command and return exit code.
func runSub(args []string) int {
	return 0
}
```

Application Layer ã®ãƒ­ã‚¸ãƒƒã‚¯ãŒå…¨ã¦ `main` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«å±•é–‹ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã‚„ã™ã®ãŒç‰¹å¾´ã€‚ [mitchellh/cli] ã§å®Ÿè£…ã—ã¥ã‚‰ã„æ§‹æˆãªã‚‰ â€œ[Like Go command]â€ ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è©¦ã—ã¦ã¿ã‚‹ã®ã‚‚ã„ã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚

[tcnksm/gcli]: https://github.com/tcnksm/gcli "The easy way to build Golang command-line application."
[flag]: https://golang.org/pkg/flag/
[codegangsta/cli]: http://deeeet.com/writing/2014/06/22/cli-init/
[mitchellh/cli]: https://github.com/mitchellh/cli
[Like Go command]: https://github.com/golang/go/blob/master/src/cmd/go/main.go#L30#L51

