---
title: "ãã‚ãã‚çœŸé¢ç›®ã« Golang é–‹ç™ºç’°å¢ƒã«ã¤ã„ã¦è€ƒãˆã‚‹ â€” Internal Packages ã¨ Vendoring"
emoji: "ğŸ˜€"
type: "tech"
topics: [Go]
published: false
---
[å‰å›]ã®ç¶šãã€‚ä¿ç•™ã—ã¦ã„ãŸ Go 1.5 ã® Vendoring æ©Ÿèƒ½ã«ã¤ã„ã¦ã€‚

ä»Šå›ã®èª¿æŸ»ã‚‚å«ã‚ã¦ä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½œã£ãŸ

[spiegel-im-spiegel/gcat]: https://github.com/spiegel-im-spiegel/gcat "spiegel-im-spiegel/gcat"
[spiegel-im-spiegel/gutil]: https://github.com/spiegel-im-spiegel/gutil "spiegel-im-spiegel/gutil"

- [spiegel-im-spiegel/gcat]
- [spiegel-im-spiegel/gutil]

[spiegel-im-spiegel/gcat] ã¯ `cat` ã‚³ãƒãƒ³ãƒ‰ç›¸å½“ã®æ©Ÿèƒ½ã‚’æŒã¤ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã§ï¼Œå†…éƒ¨ã§ [spiegel-im-spiegel/gutil] ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å‘¼ã‚“ã§ã„ã‚‹ã€‚ [spiegel-im-spiegel/gutil] ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯é›‘å¤šãªå‡¦ç†ã‚’é›†ã‚ãŸã‚‚ã®ã ãŒï¼Œã¾ã ä½œã‚Šã‹ã‘ã€‚ã¨ã‚Šã‚ãˆãš [spiegel-im-spiegel/gcat] ã§ä½¿ã†ã‚‚ã®ã ã‘ã‚’ç½®ã„ã¦ã„ã‚‹ã€‚

ã¾ãšã¯ã“ã‚Œã‚’å°å…¥ã—ã¦ã¿ã‚‹ã€‚ [spiegel-im-spiegel/gutil] ã‚’ submodule ã«ã—ã¦ã‚‹ã®ã§ã¡ã‚‡ã£ã¨ã‚¦ã‚¶ã„ã‘ã©ã”å‹˜å¼ã‚’ã€‚ã‚ã¨ï¼Œãƒ¦ãƒ¼ã‚¶åãŒé•·ã„ã®ã¯ãƒ›ãƒ³ãƒã”ã‚ã‚“ã€‚ã“ã‚“ãªã“ã¨ãªã‚‰ã‚‚ã£ã¨çŸ­ã„åå‰ã«ã™ã‚‹ã‚“ã ã£ãŸã€‚

```shell
C:>mkdir C:\workspace\gcat

C:>cd C:\workspace\gcat

C:\workspace\gcat>SET GO15VENDOREXPERIMENT=1

C:\workspace\gcat>SET GOPATH=C:\workspace\gcat

C:\workspace\gcat>go get -d github.com/spiegel-im-spiegel/gcat
# cd .; git --git-dir=C:\workspace\gcat\src\github.com\spiegel-im-spiegel\gcat/.git submodule update --init --recursive
No submodule mapping found in .gitmodules for path 'vendor/github.com/spiegel-im-spiegel/gutil'
package github.com/spiegel-im-spiegel/gcat: exit status 1

C:\workspace\gcat>pushd src\github.com\spiegel-im-spiegel\gcat

C:\workspace\gcat\src\github.com\spiegel-im-spiegel\gcat>git submodule init
Submodule 'vendor/github.com/spiegel-im-spiegel/gutil' (https://github.com/spiegel-im-spiegel/gutil.git) registered for path 'vendor/github.com/spiegel-im-spiegel/gutil'

C:\workspace\gcat\src\github.com\spiegel-im-spiegel\gcat>git submodule update
Cloning into 'vendor/github.com/spiegel-im-spiegel/gutil'...
remote: Counting objects: 25, done.
remote: Compressing objects: 100% (20/20), done.
remote: Total 25 (delta 10), reused 15 (delta 4), pack-reused 0
Unpacking objects: 100% (25/25), done.
Checking connectivity... done.
Submodule path 'vendor/github.com/spiegel-im-spiegel/gutil': checked out '7d271650d9937ef0e7b447aff5a55f410f2c9f89'

C:\workspace\gcat\src\github.com\spiegel-im-spiegel\gcat>popd

C:\workspace\gcat>go install -v ./...
github.com/spiegel-im-spiegel/gcat/vendor/github.com/spiegel-im-spiegel/gutil
github.com/spiegel-im-spiegel/gcat/internal/gcat
github.com/spiegel-im-spiegel/gcat/internal/facade
github.com/spiegel-im-spiegel/gcat

C:\workspace\gcat>echo Take the Go-lang! | bin\gcat.exe
Take the Go-lang!
```

å°å…¥æ™‚ã®ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã¯ã“ã†ãªã£ã¦ã„ã‚‹ã€‚

```shell
C:\workspace\gcat>tree .
C:\WORKSPACE\GCAT
â”œâ”€bin
â”œâ”€pkg
â”‚  â””â”€windows_amd64
â”‚      â””â”€github.com
â”‚          â””â”€spiegel-im-spiegel
â”‚              â””â”€gcat
â”‚                  â”œâ”€internal
â”‚                  â””â”€vendor
â”‚                      â””â”€github.com
â”‚                          â””â”€spiegel-im-spiegel
â””â”€src
    â””â”€github.com
        â””â”€spiegel-im-spiegel
            â””â”€gcat
                â”œâ”€internal
                â”‚  â”œâ”€facade
                â”‚  â””â”€gcat
                â””â”€vendor
                    â””â”€github.com
                        â””â”€spiegel-im-spiegel
                            â””â”€gutil
```

ã“ã®ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã«å¯¾ã—ã¦ `main.go` ã®è¨˜è¿°ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã‚ã‚‹ã€‚

```go:main.go
package main

import (
	"os"

	"github.com/spiegel-im-spiegel/gcat/internal/facade"
	"github.com/spiegel-im-spiegel/gutil"
)

func main() {
	cli := &gutil.CliContext{Reader: os.Stdin, Writer: os.Stdout, ErrorWriter: os.Stderr}
	facadeCxt := &facade.Context{Cli: cli, CommandName: Name, Version: Version}
	os.Exit(facadeCxt.Run(os.Args))
}
```

ãƒã‚¤ãƒ³ãƒˆã«ãªã‚‹ã®ã¯ `internal` ãƒ•ã‚©ãƒ«ãƒ€ã¨ `vendor` ãƒ•ã‚©ãƒ«ãƒ€ã ã€‚ã‚‚ã†å°‘ã—è©³ã—ãè¦‹ã¦ã„ã“ã†ã€‚

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å¤–éƒ¨ã‹ã‚‰ã®å‘¼ã³å‡ºã—ã‚’ç¦æ­¢ã™ã‚‹ Internal Packages

Internal Packages ã®ä»•çµ„ã¿ã¯ 1.4 ã®ã“ã‚ã‹ã‚‰å­˜åœ¨ã—ãŸãŒï¼Œ 1.5 ã‹ã‚‰ `GOPATH` é…ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¾ã§æ‹¡å¼µã•ã‚ŒãŸã€‚

- [Go 1.4 "Internal" Packages](https://docs.google.com/document/d/1e8kOo3r51b2BWtTs_1uADIA5djfXhPT36s6eHVRIvaU/edit)

è¦ã™ã‚‹ã« `internal` ãƒ•ã‚©ãƒ«ãƒ€ä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯å¤–éƒ¨ã‹ã‚‰å‚ç…§ã§ããªã„ã€‚ã“ã‚Œã¯å†åˆ©ç”¨ã®é›£ã—ã„ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã‚€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’é…ç½®ã™ã‚‹å ´åˆã«ã¯ã‚ˆã„ä»•æ›ã‘ã§ã‚ã‚‹ã€‚ Internal Packages ã®åˆ¶ç´„ã‹ã‚‰å¤–ã™ã«ã¯ `internal` ãƒ•ã‚©ãƒ«ãƒ€ã®å¤–å´ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å†é…ç½®ã™ã‚Œã°ã‚ˆã„ã€‚

## Vendoring æ©Ÿèƒ½

ç’°å¢ƒå¤‰æ•° `GO15VENDOREXPERIMENT` ã« 1 ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã¨ Go 1.5 ã® Vendoring æ©Ÿèƒ½ãŒä½¿ãˆã‚‹ã€‚

- [Go 1.5 Vendor Experiment](https://docs.google.com/document/d/1Bz5-UB7g2uPBdOx-rw5t9MxJwkfpx90cqG9AFL0JAYo/edit)

ï¼ˆ**è¿½è¨˜** å½“åˆã®äºˆå‘Šé€šã‚Š Vendoring æ©Ÿèƒ½ã¯ 1.6 ã‹ã‚‰æ—¢å®šã®æ©Ÿèƒ½ã«ãªã£ãŸã€‚ç’°å¢ƒå¤‰æ•° `GO15VENDOREXPERIMENT` ã‚’ã‚»ãƒƒãƒˆã—ãªãã¦ã‚‚æœ‰åŠ¹ã«ãªã‚‹ï¼‰

Vendoring æ©Ÿèƒ½ãŒæœ‰åŠ¹ãªçŠ¶æ…‹ã§ã¯ `vendor` ãƒ•ã‚©ãƒ«ãƒ€ãŒç‰¹åˆ¥ãªæ„å‘³ã‚’æŒã¤ã€‚ãŸã¨ãˆã° `mypackage` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«å¯¾ã—ã¦ `mypackage/vendor/vpackage` ã¨é…ç½®ã—ãŸå ´åˆï¼Œ `import "vpackage"` ã¨è¨˜è¿°ã™ã‚Œã° `mypackage/vendor` ãƒ•ã‚©ãƒ«ãƒ€ä»¥ä¸‹ã® `vpackage` ã‚’æ¢ã—ã¦ãã‚Œã‚‹ã€‚ä¸Šè¿°ã® [spiegel-im-spiegel/gcat] ã®å ´åˆã¯ `github.com/spiegel-im-spiegel/gutil` ãŒã“ã‚Œã«ã‚ãŸã‚Šï¼Œå®Ÿä½“ã¯ `github.com/spiegel-im-spiegel/gcat/vendor/github.com/spiegel-im-spiegel/gutil` ã«ã‚ã‚‹ã€‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯

```shell
C:\workspace\gcat>go install -v ./...
src\github.com\spiegel-im-spiegel\gcat\internal\gcat\catenate.go:4:2: cannot find package "github.com/spiegel-im-spiegel/gutil" in any of:
        C:\workspace\gcat\src\github.com\spiegel-im-spiegel\gcat\vendor\github.com\spiegel-im-spiegel\gutil (vendor tree)
        C:\Go\src\github.com\spiegel-im-spiegel\gutil (from $GOROOT)
        C:\workspace\gcat\src\github.com\spiegel-im-spiegel\gutil (from $GOPATH)
```

ã¨ã„ã†æ„Ÿã˜ã®ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šï¼Œ Vendor tree â†’ `GOROOT` â†’ `GOPATH` ã®é †ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æ¢ã—ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã€‚

ãŸã ã—ã“ã® Vendoring æ©Ÿèƒ½ã¯å®Ÿé¨“æ®µéšã§ã‚ã‚Šï¼Œä¸Šæ‰‹ãã„ã‘ã°æ¬¡ã‹ãã®æ¬¡ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯æ—¢å®šã§æœ‰åŠ¹ã«ãªã‚‹ã‚ˆã†ã ãŒï¼Œå½“é¢ã¯æ§˜å­è¦‹ã¨ã„ã†ã¨ã“ã‚ã ã‚ã†ã‹ã€‚

## ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯

- [Goè¨€èªã®Dependency/Vendoringã®å•é¡Œã¨ä»Šå¾Œï¼gbã‚ã‚‹ã„ã¯Go1.5 | SOTA](http://deeeet.com/writing/2015/06/26/golang-dependency-vendoring/)
- [Big Sky :: golang 1.5 ã® internal ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä½¿ã„æ–¹ã€‚](http://mattn.kaoriya.net/software/lang/go/20150820102400.htm)
- [ã€Œgolang 1.5 ã® internal ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä½¿ã„æ–¹ã€‚ã€ã‚’è©¦ã—ã¦ã¿ãŸ - Qiita](http://qiita.com/qt-luigi/items/d0f52b3b0906b35e6027)

[å‰å›]: http://qiita.com/spiegel-im-spiegel/items/73ebc684b5807277b7e2 "ãã‚ãã‚çœŸé¢ç›®ã« Golang é–‹ç™ºç’°å¢ƒã«ã¤ã„ã¦è€ƒãˆã‚‹ï¼ˆãã®1ï¼‰ - Qiita"

